<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:include="include :: header('Add Carrier Account')" />
    <th:block th:include="include :: datetimepicker-css" />
    <th:block th:include="include :: select2-css" />
</head>

<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-account-add">
            <div class="form-group">
                <label class="col-sm-4 col-xs-4 col-md-4 control-label">Đã nhận DO gốc </label>
                <div class="col-sm-3 col-xs-3 col-md-3">
                    <input class="form-check-input" type="checkbox" id="documentStatus">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 col-xs-4 col-md-4 control-label">Đã làm lệnh </label>
                <div class="col-sm-3 col-xs-3 col-md-3">
                    <input class="form-check-input" type="checkbox" value="" id="status">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-4 col-xs-4 col-md-4 control-label">Ghi chú làm lệnh </label>
                <div class="col-sm-3 col-xs-3 col-md-3">
                    <textarea  class="form-check-input" id="processRemark"> </textarea>
                </div>
            </div>
            <div class="form-group" style="display: flex; justify-content: space-between">
                <button id="buttonSave" type="button" class="btn btn-primary btn-md" onclick="updateDo()">
                    Lưu
                </button>
                <button  type="button" class="btn btn-secondary btn-md" onclick="$.modal.close();">
                    Hủy
                </button>
            </div>
        </form>

    </div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: datetimepicker-js" />
    <th:block th:include="include :: select2-js" />
    <script type="text/javascript" th:inline="javascript">
        var equipmentDo = /*[[${equipmentDos}]]*/ ;
        var billOfLading = equipmentDo.billOfLading;
        var status = equipmentDo.status;
        var documentStatus = equipmentDo.documentStatus;
    </script>
    <script type="text/javascript">
        var prefix = "/carrier/admin/do";
        document.addEventListener('DOMContentLoaded', (event) => {

            if (status == 1) {
                $("#status").prop("disabled", true)
                $("#status").prop("checked", true)
                $("#doNote").prop("disabled", true)
                $("#processRemark").prop("disabled", true)
            }

            if (documentStatus == 1) {
                $("#documentStatus").prop("disabled", true)
                $("#documentStatus").prop("checked", true)
            }

            if (status == 1 && documentStatus == 1) {
                $("#buttonSave").prop("disabled", true);
            }


        });

        function updateDo() {
            if ($('#status').is(":checked")) {
                $("#status").val(1)
            }
            if ($('#documentStatus').is(":checked")) {
                $("#documentStatus").val(1)
            }
            var status = $("#status").val();
            var doNote = $("#doNote").val();
            var processRemark = $("#processRemark").val();
            var documentStatus = $("#documentStatus").val();
            $.ajax({
                url: prefix + "/updateDoStatus",
                method: "post",
                data: {
                    billOfLading: billOfLading,
                    status: status,
                    processRemark : processRemark,
                    doNote: doNote,
                    documentStatus: documentStatus
                },
            }).done(function (result) {
               if(result.code == 0)
               {
                    $.modal.msgSuccess("Cập nhật thành công !");
                    setTimeout(function(){
                        reload()
                    }, 1000);
               } else {
                    $.modal.msgError("Cập nhật không thành công !, liên hệ Admin <br> để biết thêm chi tiết");
                        setTimeout(function(){
                        $.modal.reload()
                    }, 1000);
               }
            });
            function reload() {
                // $.modal.close();
                var parent = window.parent;
                console.log("step",1);
                if (parent.table.options.type == table_type.bootstrapTable) {
                    $.modal.close();
                    parent.$.modal.msgSuccess(result.msg);
                    parent.$.table.refresh();
                } else if (parent.table.options.type == table_type.bootstrapTreeTable) {
                    $.modal.close();
                    parent.$.modal.msgSuccess(result.msg);
                    parent.$.treeTable.refresh();
                } else {
                    $.modal.msgReload("Lưu thành công! Vui lòng chờ trong khi refresh dữ liêu...", modal_status.SUCCESS);
                }
                $.modal.closeLoading();
                $.modal.enable();
            }
            
        }
    </script>
</body>

</html>