<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('Edit Logistic Group')" />
    <th:block th:include="include :: easyui-css" />
    <style type="text/css">
		.dropdown-menu {
			position: absolute;
			top: 100%;
			left: 0;
			z-index: 1000;
			display: none;
			float: left;
			min-width: 118px;
			padding: 5px 0;
			margin: 2px 0 0;
			font-size: 14px;
			text-align: left;
			list-style: none;
			background-color: #f5f5f5 !important;
			-webkit-background-clip: padding-box;
			background-clip: padding-box;
			border: 1px solid #ccc;
			border: 1px solid rgba(0, 0, 0, 0.15);
			border-radius: 4px;
			-webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
			box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
		}
		.col-lg-1,
		.col-lg-10,
		.col-lg-11,
		.col-lg-12,
		.col-lg-2,
		.col-lg-3,
		.col-lg-4,
		.col-lg-5,
		.col-lg-6,
		.col-lg-7,
		.col-lg-8,
		.col-lg-9,
		.col-md-1,
		.col-md-10,
		.col-md-11,
		.col-md-12,
		.col-md-2,
		.col-md-3,
		.col-md-4,
		.col-md-5,
		.col-md-6,
		.col-md-7,
		.col-md-8,
		.col-md-9,
		.col-sm-1,
		.col-sm-10,
		.col-sm-11,
		.col-sm-12,
		.col-sm-2,
		.col-sm-3,
		.col-sm-4,
		.col-sm-5,
		.col-sm-6,
		.col-sm-7,
		.col-sm-8,
		.col-sm-9,
		.col-xs-1,
		.col-xs-10,
		.col-xs-11,
		.col-xs-12,
		.col-xs-2,
		.col-xs-3,
		.col-xs-4,
		.col-xs-5,
		.col-xs-6,
		.col-xs-7,
		.col-xs-8,
		.col-xs-9 {
			position: relative;
			min-height: 1px;
			padding-right: 1px !important;
			padding-left: 1px !important;
		}
		.row {
			margin-right: 0px !important;
			margin-left: 0px !important;
		}
		.error-input {
			background-color: #fbe2e2;
			border-color: #c66161;
			color: #c00;
		}
    </style>
</head>
<body class="white-bg">
    <div class="main-content">
		<div class="col-sm-6">
		<form class="form-horizontal m" id="form-group-edit" style="height: calc(100% - 36px);">
			<div class="row">
				<h2>Thông tin công ty</h2>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="form-group">
						<input name="id" th:value="${id}" type="hidden">
						<label class="col-sm-3 control-label is-required">MST doanh nghiệp：</label>
						<div class="col-sm-2">
							<input name="mst" th:value=${logisticGroup.mst} class="form-control" type="text" onfocusout="loadGroupName()" required />
						</div>
						<label class="col-sm-2 control-label">PT Thanh toán：</label>
						<input style="margin-top: 10px;" type="radio" name="creditFlag" id="cashRadio" value="0" checked />
						<label style="margin-left: 5px;">Cash</label>
						<input style="margin-top: 10px; margin-left: 20px;" type="radio" id="creditRadio" name="creditFlag" value="1" />
						<label style="margin-left: 5px;">Credit</label>
					</div>
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label is-required">Tên doanh nghiệp：</label>
				<div class="col-sm-8">
					<input name="groupName"  class="form-control" type="text" required />
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label is-required">Địa chỉ liên hệ：</label>
				<div class="col-sm-8">
					<input name="address"  class="form-control" type="text" required />
				</div>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="form-group">
						<label class="col-sm-3 control-label is-required">Điện thoại di động：</label>
						<div class="col-sm-2" style="display: relative;">
							<input name="mobilePhone" th:value=${logisticGroup.mobilePhone} class="form-control" type="text" required />
							<span style="position: absolute; right: 10px; top: 30%;"
								title="Dùng để nhận mã OTP khi đăng ký nâng hạ"><i class="fa fa-question-circle"></i></span>
						</div>
						<label class="col-sm-1 control-label is-required">Email：</label>
						<div class="col-sm-5">
							<input name="email" th:value=${logisticGroup.email} class="form-control" type="text" required />
						</div>
					</div>
				</div>
			</div>
		</form>
		</div>
		<div class="col-sm-12 footer">
			<div class="col-sm-offset-5 col-sm-10">
				<button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i
						class="fa fa-check">Lưu</i></button>&nbsp;
				<button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all">Quay
						lại</i></button>
			</div>
		</div>
	</div>
    <th:block th:include="include :: footer" />
    <th:block th:include="include :: easyui-js" />
    <script type="text/javascript" th:inline="javascript">
        var logisticGroup = /*[[${logisticGroup}]]*/ ;
		const PREFIX = ctx + "logistic/group";
        if(logisticGroup != null){
        	if(logisticGroup.creditFlag == "0"){
        		$('#cashRadio').prop("checked", true);
        	} else{
        		$('#creditRadio').prop("checked", true);
			}
			
			$('input[name=groupName]').val(logisticGroup.groupName);
			$('input[name=address]').val(logisticGroup.address);
		}
		
        $("#form-group-edit").validate({
            focusCleanup: true
		});
		
        function submitHandler() {
            if ($.validate.form()) {
				let id = logisticGroup.id;
				logisticGroup = new Object;
				logisticGroup.id = id;
				logisticGroup.mst = $('input[name=mst]').val();
				logisticGroup.creditFlag = $('#cashRadio').prop("checked")?0:1;
				logisticGroup.groupName = $('input[name=groupName]').val();
				logisticGroup.address = $('input[name=address]').val();
				logisticGroup.mobilePhone = $('input[name=mobilePhone]').val();
				logisticGroup.email = $('input[name=email]').val();
				$.modal.loading("Đang xử lý...");
				$.ajax({
					url: PREFIX + "/edit",
					method: "POST",
					contentType: "application/json",
					data: JSON.stringify(logisticGroup),
					success : function(res) {
                        if(res.code == 0)
                        {
                            $.modal.closeLoading();
                            $.modal.alertSuccess("Sửa logistic thành công");
                            parent.loadTable();
                        }else {
                            $.modal.closeLoading();
                            $.modal.alertError(res.msg)
                        }
					},
					error : function(res) {
						$.modal.closeLoading();
						$.modal.alertError("Có lỗi xảy ra, vui lòng liên hệ admin.")
					}
				});
            }
        }

		laydate.render({
			elem: 'input[name=validFrom]',
			format: "dd/MM/yyyy"
		});

      	laydate.render({
			elem: 'input[name=validUntil]',
			format: "dd/MM/yyyy"
		});

		function formatDate(value) {
			if (value == null) return "";
			var date = new Date(value);
			return formatNumber(date.getDate())
			+ "/" + formatNumber(date.getMonth() + 1)
			+ "/" + date.getFullYear()
		}

		function formatNumber(number) {
			return number < 10 ? "0" + number : number;
		}

		function formatDelegateType(value) {
			console.log(value);
			switch (value) {
				case 'P':
					return 'Làm Lệnh';
				case 'M':
					return 'Thanh Toán';
			}
			return '';
		}

		function formatValidFlg(value) {
			if (1 == value) {
				return '<span style="color: green">Hiệu lực</span>';
			}
			return '<span style="color: red">Vô hiệu</span>';
		}

		function formatAction(value, row, index) {
			let actions = [];
			if (row.id) {
				actions.push('<a class="btn btn-success btn-xs " onclick="editt(\'' + row.id + '\')"><i class="fa fa-remove"></i>Chỉnh sửa</a><span>  </span>');
			}
			actions.push('<a class="btn btn-danger btn-xs " onclick="remove(\'' + index + '\',\'' + row.id + '\')"><i class="fa fa-remove"></i>Xóa</a>');
			return actions.join('');
		}

		
		$.event.special.inputchange = {
			setup: function () {
				var self = this, val;
				$.data(
					this,
					"timer",
					window.setInterval(function () {
						val = self.value;
						if ($.data(self, "cache") != val) {
							$.data(self, "cache", val);
							$(self).trigger("inputchange");
						}
					}, 20)
				);
			},
			teardown: function () {
				window.clearInterval($.data(this, "timer"));
			},
			add: function () {
				$.data(this, "cache", this.value);
			}
		};	
		function stringToDate(dateStr) {
			let dateParts = dateStr.split('/');
			return new Date(dateParts[2], dateParts[1] - 1, dateParts[0]);
		} 

    </script>
</body>
</html>