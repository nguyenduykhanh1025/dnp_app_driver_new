<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vn.com.irtech.api.dao.ShipmentDetailDao">

    <sql id="selectContainerDetailVo">
        SELECT
			M.CNTR_NO, M.SZTP, M.FE, M.IX_CD, M.PTNR_CODE, 
			(SELECT ENG_SNM FROM DNP_PROD.TB_PTNR WHERE PTNR_CODE = M.PTNR_CODE AND PTNR_TYPE = 'SHP') AS PTNR_NAME,
			<!-- Vessel Info -->
			M.VSL_CD, M.CALL_YEAR, M.CALL_SEQ, M.USER_VOY,
			(SELECT VSL_NM FROM DNP_PROD.TB_VSL WHERE VSL_CD = M.VSL_CD) AS VSL_NM,
			(SELECT B.IN_VOY FROM DNP_PROD.TB_BERTHPLAN B WHERE B.VSL_CD = M.VSL_CD AND B.CALL_YEAR = M.CALL_YEAR AND B.CALL_SEQ = M.CALL_SEQ) AS IN_VOY,
			M.BOOKING_NO, M.BL_NO, M.CARGO_TYPE, M.SEAL_NO1, M.SEAL_NO3, M.WGT, M.CONSIGNEE, M.VGM, M.CHOLD_CHK, M.THOLD_CHK, M.POD, M.POL,
			CASE
				WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
				WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
				WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
				WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
				WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
				ELSE M.TRANS_TYPE
			END AS TRANS_TYPE,
			
			CASE
				WHEN M.CNTR_STATE = 'R' THEN 'Reserved'
				WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
				WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
				WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
				WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
				WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
				WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
				WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
				WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
				WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
				ELSE M.CNTR_STATE
			END AS CNTR_STATE,
			M.REMARK,
			M.BLOCK || '-' || M.BAY || '-' || M.ROWW || '-' || M.TIER AS LOCATION,
			M.AREA,
			M.JOB_ODR_NO,
			M.JOB_ODR_NO2,
			M.IMDG,
			M.UNNO
    </sql>

	<!-- Query container info with oversize container info from oversize table -->
	<sql id="customInventoryTable">
		SELECT 'TB_INVENTORY'
				TABLE_NAME,
			M.VSL_CD,
			M.CALL_YEAR,
			M.CALL_SEQ,
			M.SO_NO,
			M.CNTR_NO,
			FE,
			IX_CD,
			PTNR_CODE,
			SHIFT_ACC,
			SZTP,
			SZTP2,
			POR,
			POD,
			FDEST,
			DELV,
			WGT,
			CARGO_TYPE,
			SET_TEMP,
			AIRVENT,
			IMDG,
			UNNO,
			DMG_COND,
			SUBSTR (M.SZTP2, 1, 1)
				AS CNTR_LEN,
			SUBSTR (M.SZTP2, 2, 1)
				AS CNTR_HW,
			SUBSTR (M.SZTP2, 3, 2)
				AS CNTR_TYPE,
			SEAL_NO1,
			SEAL_NO2,
			BOOKING_NO,
			BL_NO,
			O.OV_HEIGHT,
			O.OV_FORE,
			O.OV_AFT,
			O.OV_PORT,
			O.OV_STBD,
			O.OS_HEIGHT,
			O.OS_PORT,
			O.OS_STBD,
			TRUCKER,
			TRANS_TYPE,
			M.TRANS_TYPE2,
			PREV_VSL,
			PREV_YEAR,
			PREV_SEQ,
			REMARK,
			M.IN_TMNL_DATE,
			M.IN_DATE,
			M.OUT_DATE,
			M.DISPATCH_MODE,
			M.DISPATCH_MODE2,
			M.JOB_ODR_NO,
			M.JOB_ODR_NO2,
			USER_VOY,
			NVL (EMTY_CHK, 'N')
				AS EMTY_CHK,
			AREA,
			STORAGE_CODE,
			COD,
			POL,
			FPOD,
			CNTR_STATE,
			EDI_TEMP,
			PREV_USER_VOY,
			SHIFT_TIME,
			SHIFT_TYPE,
			SHIFT_RSN,
			CONSIGNEE,
			SEAL_NO3,
			CHOLD_CHK,
			NVL (THOLD_CHK, 'N')
				AS THOLD_CHK,
			IN_LANE,
			OUT_LANE,
			SOC_CHK,
			NVL (DG_CHK, 'N')
				AS DG_CHK,
			RETURN_RSN,
			NVL (DOMESTIC_CHK, 'N')
				AS DOMESTIC_CHK,
			LBAY,
			LROW,
			LTIER,
			DBAY,
			DROW,
			DTIER,
			BLOCK,
			BAY,
			ROWW,
			TIER,
			OWNER,
			GWAY,
			HANDLE_INSTR,
			YHANDLE_INSTR,
			YSPECIAL_TYPE,
			ABS_CONST,
			TRN_VOY,
			TRN_VOY2,
			TRUCKER2,
			TRUCK_NO,
			TRUCK_NO2,
			UNPLUG_INSTR,
			CNTR_COND,
			DEFECTIVE_CODE,
			CLEAN_CODE,
			POWER_CODE,
			NVL (M.REHANDLE_CODE, 'U')
				AS REHANDLE_CODE,
			REHANDLE_RSN,
			REHANDLE_STAFF,
			LCL_FCL,
			DHD,
			LHD,
			DHATCH_IDX,
			LHATCH_IDX,
			NVL (M.DMG_CHK, 'N')
				AS DMG_CHK,
			STUFF_CHK,
			NVL (M.OVERLAND_CHK, 'N')
				AS OVERLAND_CHK,
			NVL (M.RELEASE_CHK, 'N')
				AS RELEASE_CHK,
			NVL (INSPECT_CHK, 'N')
				AS INSPECT_CHK,
			FORWARDER,
			COMMODITY,
			DEQU_NO,
			LEQU_NO,
			PREINFO_CHK,
			LBAY_SEQ,
			BAY_IDX,
			ROW_IDX,
			M.CNTR_ID,
			M.CNTR_UID,
			TO_NUMBER (
				TRUNC (NVL (M.OUT_DATE, SYSDATE))
				- TRUNC (NVL (M.IN_TMNL_DATE, M.IN_DATE))
				+ 1)
				AS STACK_DAYS,
			CEIL (
				NVL (M.OUT_DATE, SYSDATE)
				- NVL (M.IN_TMNL_DATE, M.IN_DATE))
				AS STACK_DAYS_D24,
			M.DBAY || M.DROW || M.DTIER
				AS SHIP_LOCD,
			M.LBAY || M.LROW || M.LTIER
				AS SHIP_LOCL,
			M.VGM,
			M.VGM_CHK,
			M.CUSTOM_APP_TYPE,
			M.COMMODITY_DESC,
			M.CONSIGNEE_NM,
			M.CNTR_RMK1,
			M.DOOR_DIR
		FROM DNP_PROD.TB_INVENTORY M, DNP_PROD.TB_OVERSIZE O
		WHERE M.CNTR_ID = O.CNTR_ID(+)
    </sql>

    <select id="selectShipmentDetailsByBLNo" parameterType="String" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
			,M.OV_HEIGHT,
			M.OV_FORE,
			M.OV_AFT,
			M.OV_PORT,
			M.OV_STBD,
			M.OS_HEIGHT,
			M.OS_PORT,
			M.OS_STBD
            FROM (<include refid="customInventoryTable"/>) M
        <where>
            AND M.BL_NO = #{blNo}
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
			,NULL AS OV_HEIGHT,
			NULL AS OV_FORE,
			NULL AS OV_AFT,
			NULL AS OV_PORT,
			NULL AS OV_STBD,
			NULL AS OS_HEIGHT,
			NULL AS OS_PORT,
			NULL AS OS_STBD 
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_STATE = 'R'
            AND M.BL_NO = #{blNo}
        </where>
    </select>

	<select id="selectContainerInfoByBLNo" parameterType="String" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
			, M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_INVENTORY M
        <where>
            AND M.BL_NO = #{blNo}
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
            , null as IN_DATE, null as OUT_DATE
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_STATE = 'R'
            AND M.BL_NO = #{blNo}
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
			, M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_MASTER M
        <where>
            AND M.CNTR_STATE = 'D'
            AND M.BL_NO = #{blNo}
        </where>
    </select>

	<select id="selectContainerInfoByCntrInfo" parameterType="vn.com.irtech.api.dto.ContainerInfoDto" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
			, M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_INVENTORY M
        <where>
			<if test="cntrNo != null and cntrNo != ''"> AND M.CNTR_NO = #{cntrNo}</if>
			<if test="blNo != null and blNo != ''"> AND M.BL_NO = #{blNo}</if>
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
            , null as IN_DATE, null as OUT_DATE
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_STATE = 'R'
            <if test="cntrNo != null and cntrNo != ''"> AND M.CNTR_NO = #{cntrNo}</if>
			<if test="blNo != null and blNo != ''"> AND M.BL_NO = #{blNo}</if>
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
			, M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_MASTER M
        <where>
            AND M.CNTR_STATE = 'D'
            <if test="cntrNo != null and cntrNo != ''"> AND M.CNTR_NO = #{cntrNo}</if>
			<if test="blNo != null and blNo != ''"> AND M.BL_NO = #{blNo}</if>
        </where>
    </select>

	<select id="selectShipmentDetailByContainerNos" parameterType="String" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
            , M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_INVENTORY M
        <where>
			AND M.CNTR_NO in
			<foreach item="containerNo" collection="array" open="(" separator="," close=")">
				#{containerNo}
			</foreach>
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
            , NULL as IN_DATE, NULL as OUT_DATE
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_STATE = 'R'
            AND M.CNTR_NO in
			<foreach item="containerNo" collection="array" open="(" separator="," close=")">
				#{containerNo}
			</foreach>
        </where>
    </select>
    
    <select id="selectAllShipmentDetailByContainerNos" parameterType="String" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
            , M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_INVENTORY M
        <where>
            AND M.CNTR_NO in
            <foreach item="containerNo" collection="array" open="(" separator="," close=")">
                #{containerNo}
            </foreach>
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
            , null as IN_DATE, null as OUT_DATE
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_STATE = 'R'
            AND M.CNTR_NO in
            <foreach item="containerNo" collection="array" open="(" separator="," close=")">
                #{containerNo}
            </foreach>
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
            , M.IN_DATE, M.OUT_DATE
            FROM DNP_PROD.TB_MASTER M
        <where>
            AND M.CNTR_STATE = 'D'
            AND M.CNTR_NO in
            <foreach item="containerNo" collection="array" open="(" separator="," close=")">
                #{containerNo}
            </foreach>
        </where>
    </select>

    <select id="selectShipmentDetailByJobOdrNo" parameterType="String" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
            FROM DNP_PROD.TB_INVENTORY M
        <where>
            AND (M.JOB_ODR_NO = #{jobOdrNo} OR M.JOB_ODR_NO2 = #{jobOdrNo} )
        </where>
        UNION ALL
        <include refid="selectContainerDetailVo"/>
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_STATE = 'R'
            AND (M.JOB_ODR_NO = #{jobOdrNo} OR M.JOB_ODR_NO2 = #{jobOdrNo} )
        </where>
    </select>

    <select id="selectShipmentDetailByContNo"  resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE ||': ' || (SELECT ENG_SNM FROM DNP_PROD.TB_PTNR WHERE PTNR_CODE = M.PTNR_CODE AND PTNR_TYPE = 'SHP') AS opeCode,
                (SELECT VSL_NM FROM DNP_PROD.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslName,
                M.VSL_CD ||': '|| (SELECT VSL_NM FROM DNP_PROD.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslNm,
                M.CALL_YEAR AS year,
                (SELECT B.IN_VOY FROM DNP_PROD.TB_BERTHPLAN B WHERE B.VSL_CD = M.VSL_CD AND B.CALL_YEAR = M.CALL_YEAR AND B.CALL_SEQ = M.CALL_SEQ) AS voyCarrier,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.CALL_SEQ AS voyNo,
                CASE
                	WHEN M.chold_chk = 'N' then 'R'
                	WHEN M.chold_chk = 'Y' then 'N'
                END AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus,
				REMARK AS containerRemark,
				BLOCK || '-' || BAY || '-' || ROWW || '-' || TIER AS location,
				M.IMDG AS dangerousImo,
				M.UNNO AS dangerousUnno,
				M.OV_HEIGHT AS ovHeight,
				M.OV_FORE AS ovFore,
				M.OV_AFT AS ovAft,
				M.OV_PORT AS ovPort,
				M.OV_STBD AS ovStbd,
				M.OS_HEIGHT AS osHeight,
				M.OS_PORT AS osPort,
				M.OS_STBD AS osStbd
					FROM (<include refid="customInventoryTable"/>) M
		<where>
			<if test="containerNo != null and containerNo != ''"> AND CNTR_NO = #{containerNo}</if>
			<if test="blNo != null and blNo != ''">
				AND BL_NO = #{blNo}
				AND OPR_EXPIRE_DATE IS NULL
				AND JOB_ODR_NO2 IS NULL
				AND IX_CD = 'I'
			</if>
		</where>
		UNION ALL
		SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE ||': ' || (SELECT ENG_SNM FROM DNP_PROD.TB_PTNR WHERE PTNR_CODE = M.PTNR_CODE AND PTNR_TYPE = 'SHP') AS opeCode,
                (SELECT VSL_NM FROM DNP_PROD.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslName,
                M.VSL_CD ||': '|| (SELECT VSL_NM FROM DNP_PROD.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslNm,
                M.CALL_YEAR AS year,
                (SELECT B.IN_VOY FROM DNP_PROD.TB_BERTHPLAN B WHERE B.VSL_CD = M.VSL_CD AND B.CALL_YEAR = M.CALL_YEAR AND B.CALL_SEQ = M.CALL_SEQ) AS voyCarrier,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.CALL_SEQ AS voyNo,
                CASE
                	WHEN M.chold_chk = 'N' then 'R'
                	WHEN M.chold_chk = 'Y' then 'N'
                END AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus,
				REMARK AS containerRemark,
				BLOCK || '-' || BAY || '-' || ROWW || '-' || TIER AS location,
				M.IMDG AS dangerousImo,
				M.UNNO AS dangerousUnno,
				NULL AS ovHeight,
				NULL AS ovFore,
				NULL AS ovAft,
				NULL AS ovPort,
				NULL AS ovStbd,
				NULL AS osHeight,
				NULL AS osPort,
				NULL AS osStbd
			          FROM DNP_PROD.TB_RESERVE M
		<where>
			<if test="containerNo != null and containerNo != ''"> AND CNTR_NO = #{containerNo}</if>
			<if test="blNo != null and blNo != ''">
				AND BL_NO = #{blNo}
				AND OPR_EXPIRE_DATE IS NULL
				AND JOB_ODR_NO2 IS NULL
				AND IX_CD = 'I'
			</if>
		</where>
		FETCH NEXT 1 ROWS ONLY

    </select>
    
    <select id="selectCoordinateOfContainers" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
       SELECT            
           CNTR_NO AS containerNo,
           BL_NO AS blNo,
           BLOCK AS block,
           ROWW AS roww,
           BAY AS bay,
           TIER AS tier
        FROM DNP_PROD.TB_INVENTORY
        WHERE BL_NO = #{blNo}
        ORDER BY CNTR_NO ASC
    </select>
    
    <select id="selectVesselCodeList" resultType="String">
        SELECT
               VSL_CD||': '||VSL_NM AS VSL_CD
       	FROM DNP_PROD.TB_VSL
	</select>
	
	<select id="selectPODList" parameterType="ShipmentDetailEntity"	resultType="String">
		SELECT 
   			POD || ': ' ||(SELECT PORT_NM FROM DNP_PROD.TB_PORT WHERE CNTRY_CD = SUBSTR(POD, 1, 2) AND PORT_CD = SUBSTR(POD, 3)) AS POD
		FROM DNP_PROD.TB_VSL_POD
		<where>
		  <if test="vslNm != null and vslNm != ''"> AND VSL_CD = #{vslNm}</if>
		  <if test="voyNo != null and voyNo != ''"> AND CALL_SEQ = #{voyNo}</if>
		  <if test="year != null and year != ''"> AND CALL_YEAR = #{year}</if>
		</where>
		GROUP BY POD
        ORDER BY POD ASC
	</select>
	
	<select id="selectOPRList" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT PTNR_CODE 
		    FROM DNP_PROD.TB_VSL_OPR
        <where>
          <if test="vslNm != null and vslNm != ''"> AND VSL_CD = #{vslNm}</if>
          <if test="voyNo != null and voyNo != ''"> AND CALL_SEQ = #{voyNo}</if>
          <if test="year != null and year != ''"> AND CALL_YEAR = #{year}</if>
        </where>
		GROUP BY PTNR_CODE
		ORDER BY PTNR_CODE ASC
	</select>
	
	<select id="selectConsigneeList" resultType="String">
		SELECT 
	    	ENG_SNM AS CONSIGNEE
		FROM DNP_PROD.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND REG_NO IS NOT NULL
		    AND UNUSED_CHK = 'N'
	</select>

	<select id="selectConsigneeListWithoutTaxCode" resultType="String">
		SELECT 
	    	ENG_SNM AS CONSIGNEE
		FROM DNP_PROD.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND UNUSED_CHK = 'N'
	</select>
	
	<select id="selectVoyageNoListByVesselCode" parameterType="String" resultType="String">
		SELECT
	    	CALL_SEQ AS VOYAGE
		FROM DNP_PROD.TB_BERTHPLAN
		WHERE VSL_CD = #{vesselCode}
		       AND longterm_eta IS NOT NULL
		       AND atc IS NULL
	    ORDER BY CALL_SEQ ASC
	</select>	
	<select id="selectOpeCodeList" resultType="String">
	    SELECT 
        	PTNR_CODE || ': ' || ENG_SNM AS PTNR_CODE
	    FROM DNP_PROD.TB_PTNR
	    WHERE PTNR_TYPE = 'SHP'
	        AND UNUSED_CHK = 'N'
	        AND PTNR_CODE NOT IN ('000','OWN')
        ORDER BY PTNR_CODE ASC
	</select>
	
	<select id="getGroupNameByTaxCode" parameterType="String" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	ENG_SNM as groupName,
	    	ADDR as address
		FROM DNP_PROD.TB_PTNR
		WHERE TRIM(REG_NO) = #{taxCode}
		    AND UNUSED_CHK = 'N' 
		    AND ROWNUM = 1
	</select>
	<select id="checkContReservedByContainerNos" parameterType="String" resultType="String">
		SELECT 
			CNTR_NO
		FROM DNP_PROD.TB_RESERVE
		WHERE CNTR_STATE != 'D' AND CNTR_NO IN 
		<foreach item="containerNo" collection="array" open="(" separator="," close=")">
           	#{containerNo}
       	</foreach>
	</select>
	
    <select id="checkPickupByContainerNos" parameterType="String" resultType="String">
        SELECT 
            CNTR_NO || '/' || IX_CD || '/' || USER_VOY || '/' || PTNR_CODE || '/' || JOB_ODR_NO2 as CNTR_NO
        FROM (
          SELECT CNTR_NO, IX_CD, USER_VOY, PTNR_CODE, JOB_ODR_NO2
            FROM DNP_PROD.TB_INVENTORY
          WHERE
            JOB_ODR_NO2 IS NOT NULL
            AND CNTR_NO IN 
            <foreach item="containerNo" collection="containerNos" open="(" separator="," close=")">
              #{containerNo}
            </foreach>
            <if test="userVoy != null and userVoy != ''"> AND USER_VOY = #{userVoy}</if>
          UNION ALL
          SELECT CNTR_NO, IX_CD, USER_VOY, PTNR_CODE, JOB_ODR_NO2
            FROM DNP_PROD.TB_RESERVE
          WHERE
            JOB_ODR_NO2 IS NOT NULL
            AND CNTR_NO IN 
            <foreach item="containerNo" collection="containerNos" open="(" separator="," close=")">
              #{containerNo}
            </foreach>
            <if test="userVoy != null and userVoy != ''"> AND USER_VOY = #{userVoy}</if>
        )
    </select>

    <select id="getCountContByBlNo" parameterType="String" resultType="Integer">
		SELECT COUNT(*)
		FROM DNP_PROD.TB_INVENTORY
		WHERE BL_NO = #{blNo}
    </select>
    <select id="getOpeCodeCatosByBlNo" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentEntity">
    	SELECT PTNR_CODE AS opeCode, COUNT(*) AS containerAmount
    	FROM DNP_PROD.TB_INVENTORY
    	   WHERE BL_NO = #{blNo}
    	   GROUP BY PTNR_CODE
		UNION
		SELECT PTNR_CODE AS opeCode, COUNT(*) AS containerAmount
    	FROM DNP_PROD.TB_RESERVE
    	   WHERE BL_NO = #{blNo}
    	   GROUP BY PTNR_CODE
    </select>
    <select id="checkCustomStatus" resultType="java.lang.Boolean">
    	SELECT CASE
    				WHEN HOLD_CHK = 'N' THEN 'true'
    				WHEN HOLD_CHK = 'Y' THEN 'false'
    			END AS HOLD_CHK
    	FROM DNP_PROD.TB_HOLD_STATE
    	WHERE HOLD_TYPE = 'C'
    		AND CNTR_NO = #{containerNo}
    		AND CALL_SEQ = #{voyNo}
    </select>
    <select id="selectVesselCodeBerthPlan" parameterType="String" resultType="String">
		SELECT t.VSL_CD||': '|| (SELECT VSL_NM FROM DNP_PROD.TB_VSL WHERE VSL_CD = t.VSL_CD) AS VSL_CD
		  FROM DNP_PROD.tb_berthplan t
		WHERE  PTNR_CODE = #{opeCode}
		       AND t.vsl_cd NOT IN ('DBO','EMTY',
		                            'STRG',
		                            'TBA',
		                            'DUMY')
		       AND t.longterm_eta IS NOT NULL
		       AND t.atc IS NULL
		GROUP BY VSL_CD
        ORDER BY VSL_CD ASC
	</select>
	<select id="selectVesselVoyageBerthPlan" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
		SELECT t.vsl_cd as vslNm,
		       t.call_seq as voyNo,
		       t.call_year as year,
		       t.in_voy as voyCarrier,
			   t.longterm_eta as eta,
		       t.vsl_cd || ' - ' || (select vsl_nm FROM DNP_PROD.tb_vsl where vsl_cd = t.vsl_cd) ||' - '|| t.in_voy as vslAndVoy
		 FROM DNP_PROD.tb_berthplan t
		 where t.ptnr_code = #{opeCode}
		 		 			    AND   t.vsl_cd NOT IN ('DBO','EMPTY',
			                            'STRG',
			                            'TBA',
			                            'DUMY')
			       AND t.longterm_eta IS NOT NULL
			       AND t.atc IS NULL
		 ORDER BY t.vsl_cd ASC
	</select>
	<select id="getYearByVslCodeAndVoyNo" resultType="String">
		SELECT CALL_YEAR
		  FROM DNP_PROD.tb_berthplan t
		WHERE  VSL_CD = #{vesselCode} and CALL_SEQ = #{voyNo}
		       AND t.vsl_cd NOT IN ('DBO','EMTY',
		                            'STRG',
		                            'TBA',
		                            'DUMY')
		       AND t.longterm_eta IS NOT NULL
		       AND t.atc IS NULL
	</select>
	<select id="selectOpeCodeListInBerthPlan" resultType="String">
			SELECT t.PTNR_CODE || ': ' || (SELECT ENG_SNM FROM DNP_PROD.TB_PTNR WHERE PTNR_CODE = t.PTNR_CODE AND ROWNUM = 1) AS PTNR_CODE
			FROM DNP_PROD.tb_berthplan t
			WHERE
			       t.vsl_cd NOT IN ('DBO','EMPTY',
			                            'STRG',
			                            'TBA',
			                            'DUMY')
			       AND t.longterm_eta IS NOT NULL
			       AND t.atc IS NULL
			 GROUP BY PTNR_CODE
	</select>
	<select id="checkBookingNoForSendFReceiveE" resultType="Integer">
			SELECT COUNT(*)
			FROM DNP_PROD.TB_BOOKING
			WHERE BOOKING_NO = #{bookingNo} AND FE = #{fe}
	</select>
	<select id="getInforSendFReceiveE" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
		SELECT  BO.VSL_CD as vslNm,
		        BO.CALL_YEAR as year,
		        BO.CALL_SEQ as voyNo,
		        BO.PTNR_CODE as opeCode,
		        BO.POD || ': ' ||(SELECT PORT_NM FROM DNP_PROD.TB_PORT WHERE CNTRY_CD = SUBSTR(BO.POD, 1, 2) AND PORT_CD = SUBSTR(BO.POD, 3)) as dischargePort,
		        BO.CARGO_TYPE as cargoType,
		        BO.SZTP2 as sztp,
		        BO.VSL_CD || ' - ' || (SELECT VSL_NM FROM DNP_PROD.TB_VSL WHERE VSL_CD = BO.VSL_CD ) || ' - ' || 
		        (SELECT B.IN_VOY
		         FROM DNP_PROD.TB_BERTHPLAN B
		         WHERE
		            B.VSL_CD = BO.VSL_CD AND
		            B.CALL_YEAR = BO.CALL_YEAR AND
		            B.CALL_SEQ = BO.CALL_SEQ AND
		            B.PTNR_CODE = BO.PTNR_CODE) as vslAndVoy
		FROM DNP_PROD.TB_BOOKING BO
		WHERE BO.BOOKING_NO = #{bookingNo} AND BO.SZTP2 = #{sztp} AND BO.PTNR_CODE = #{opeCode} AND BO.FE = #{fe}
	</select>
	<select id="getIndexContMasterForSSRByContainerNo" parameterType="String" resultType="Date">
		SELECT IN_DATE FROM DNP_PROD.TB_MASTER
		WHERE CNTR_NO = #{containerNo}
	</select>
	<select id="getIndexBooking" parameterType="ShipmentDetailEntity" resultType="ShipmentDetailEntity">
		SELECT 
		    VSL_CD AS vslNm,
		    CALL_SEQ AS voyNo,
		    BOOKING_NO AS bookingNo,
		    PTNR_CODE AS opeCode,
		    SZTP2 AS sztp
		FROM DNP_PROD.TB_BOOKING
		WHERE VSL_CD = #{vslNm} AND
		      CALL_SEQ = #{voyNo} AND
		      CALL_YEAR = #{year}
	</select>
	<select id="getLocationForReceiveF" resultType="ShipmentDetailEntity">
	       SELECT            
           CNTR_NO AS containerNo,
           BL_NO AS blNo,
           BLOCK AS block,
           ROWW AS roww,
           BAY AS bay,
           TIER AS tier
        FROM DNP_PROD.TB_INVENTORY
        WHERE BL_NO = #{blNo} AND CNTR_NO = #{containerNo}
	</select>
	<select id="checkContainerStatus" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT 
			CASE
				WHEN CNTR_STATE = 'R' THEN 'Before Reconcile'
				WHEN CNTR_STATE = 'B' THEN 'After Reconcile'
				WHEN CNTR_STATE = 'M' THEN 'Manifested'
				WHEN CNTR_STATE = 'Y' THEN 'Stacking'
				WHEN CNTR_STATE = 'G' THEN 'In Progress Outgoing'
				WHEN CNTR_STATE = 'O' THEN 'In Progress Incoming'
				WHEN CNTR_STATE = 'P' THEN 'Assigned by Trucker'
				WHEN CNTR_STATE = 'Z' THEN 'Under Shifting'
				WHEN CNTR_STATE = 'D' THEN 'Delivered'
				WHEN CNTR_STATE = 'E' THEN 'Empty Gate Out'
				ELSE CNTR_STATE
			END AS containerStatus
		FROM DNP_PROD.TB_MASTER
		<where>
			<if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
			<if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
			<if test="fe != null  and fe != ''"> and FE = #{fe}</if>
			<if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
			<if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
			<if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
			<if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
			<if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
		</where>
	</select>
	<select id="getBlockList" parameterType="String" resultType="String">
		SELECT BLOCK FROM DNP_PROD.TB_BLOCK
        WHERE BLOCK like concat(concat('%', #{keyword}), '%')
	</select>
	<select id="getAreaList" parameterType="String" resultType="String">
		SELECT AREA FROM DNP_PROD.TB_AREA
        WHERE AREA like concat(concat('%', #{keyword}), '%')
        ORDER BY AREA
	</select>
	<select id="checkContReserved" parameterType="ShipmentDetailEntity" resultType="ShipmentDetailEntity">
		SELECT 
			CNTR_NO AS containerNo,
			BOOKING_NO AS bookingNo,
			PTNR_CODE AS opeCode,
			VSL_CD AS vslNm,
			CALL_SEQ AS voyNo,
			SZTP2 AS sztp
		FROM DNP_PROD.TB_RESERVE 
         <where>
            <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
            <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
            <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
            <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
            <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
            <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
            <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
        </where>
	</select>
	<select id="checkTheNumberOfContainersNotOrderedForReceiveContEmpty" resultType="Integer">
		SELECT
		    (SELECT BOOK_QTY FROM DNP_PROD.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}) - COUNT(*) AS RESULT
		FROM DNP_PROD.TB_INVENTORY
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'E' AND SZTP2 = #{sztp} AND JOB_ODR_NO2 IS NOT NULL
		GROUP BY BOOKING_NO
	</select>

	<select id="checkTheNumberOfContainersOrderedForReceiveContEmpty" resultType="Integer">
		SELECT
		    (SELECT BOOK_QTY FROM DNP_PROD.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}) - COUNT(*) AS RESULT
		FROM DNP_PROD.TB_INVENTORY
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'E' AND SZTP2 = #{sztp}
		GROUP BY BOOKING_NO
	</select>

	<select id="checkTheNumberOfContainersNotOrderedForSendContFull" resultType="Integer">
		SELECT
		    (SELECT BOOK_QTY FROM DNP_PROD.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}) - COUNT(*) AS RESULT
		FROM DNP_PROD.TB_RESERVE
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'F' AND SZTP2 = #{sztp} AND JOB_ODR_NO IS NOT NULL
		GROUP BY BOOKING_NO
	</select>

	<select id="selectBookingQuantity" resultType="int"> 
		SELECT BOOK_QTY FROM DNP_PROD.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}
	</select>

	<select id="selectBookingOrderEmptyQuantity" resultType="int">
		SELECT COUNT(*) 
		FROM DNP_PROD.TB_INVENTORY
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'E' AND SZTP2 = #{sztp} AND JOB_ODR_NO2 IS NOT NULL
	</select>
	
	<select id="selectConsigneeTaxCode" parameterType="vn.com.irtech.api.dto.PartnerInfoDto" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	CONCAT(TRIM(REG_NO) ,CONCAT(': ',ENG_LNM)) as groupName,
	    	TRIM(REG_NO) AS taxCode
		FROM DNP_PROD.TB_PTNR
		<where>
			REG_NO IS NOT NULL
			AND UNUSED_CHK = 'N'
			<if test="groupName != null  and groupName != ''"> AND UPPER(CONCAT(TRIM(REG_NO) ,CONCAT(': ',ENG_LNM))) LIKE CONCAT(CONCAT('%', #{groupName}), '%')</if>
		</where>
		GROUP BY ENG_LNM, REG_NO
	</select>

	<select id="getSztpByContainerNoMaster" parameterType="String" resultType="String">
		SELECT SZTP
		FROM DNP_PROD.TB_MASTER
		WHERE CNTR_NO = #{containerNo}
		fetch next 1 rows only
	</select>

	<select id="getSztpByContainerNoInventory" parameterType="String" resultType="String">
		SELECT SZTP
		FROM DNP_PROD.TB_INVENTORY
		WHERE CNTR_NO = #{containerNo}
		fetch next 1 rows only
	</select>

	<select id="getTaxCodeBySnmGroupName" parameterType="String" resultType="String">
		SELECT 
	    	TRIM(REG_NO) AS TAXCODE
		FROM DNP_PROD.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND ENG_SNM = #{consignee}
		    AND UNUSED_CHK = 'N'
        FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getblNoByJobOrderNo" parameterType="String" resultType="String">
		SELECT 
			BL_NO
		FROM DNP_PROD.TB_INVENTORY
		WHERE JOB_ODR_NO2 = #{jobOrdNo2}
		FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getConsigneeByTaxCode" parameterType="String" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	ENG_SNM as groupName,
	    	ADDR as address
		FROM DNP_PROD.TB_PTNR
		WHERE PTNR_TYPE = 'CNS' 
		    AND UNUSED_CHK = 'N'
		    AND TRIM(REG_NO) = #{taxCode} AND ROWNUM = 1
	</select>

	<select id="getOprCodeList" resultType	="String">
		SELECT PTNR_CODE || ': ' || ENG_SNM AS PTNR_CODE
		  FROM DNP_PROD.TB_PTNR 
		  WHERE PTNR_TYPE = 'SHP' 
		      AND PTNR_CODE NOT IN ('000','OWN')
		      AND UNUSED_CHK = 'N'
	</select>

	<select id="selectVesselVoyageBerthPlanWithoutOpe" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
		SELECT t.vsl_cd as vslNm,
		       t.call_seq as voyNo,
		       t.call_year as year,
		       t.in_voy as voyCarrier,
			   t.longterm_eta as eta,
			   t.etd as etd,
		       t.vsl_cd || ' - ' || (select vsl_nm FROM DNP_PROD.tb_vsl where vsl_cd = t.vsl_cd) ||' - '|| t.in_voy as vslAndVoy,
			   t.ptnr_code as opeCode
		 FROM DNP_PROD.tb_berthplan t
		 where t.vsl_cd NOT IN ('DBO','EMPTY',
			                            'STRG',
			                            'TBA',
			                            'DUMY')
			       AND t.longterm_eta IS NOT NULL
			       AND t.atc IS NULL
         ORDER BY t.vsl_cd ASC
	</select>
	
	<select id="getBookingInfo" resultType="vn.com.irtech.api.form.BookingInfo">
        SELECT
		    USER_VOY as userVoy,
		    BOOKING_NO as bookingNo,
		    SZTP as sztp,
		    BOOK_QTY as bookQty,
		    (
		        SELECT
		            COUNT(*)
		        FROM
		            "DNP_PROD"."TB_INVENTORY" "A2"
		        WHERE
		            "A2"."BOOKING_NO" = "A1"."BOOKING_NO"
		            AND "A2"."SZTP" = "A1"."SZTP"
		            AND "A2"."JOB_ODR_NO2" IS NOT NULL
		    ) usedQty
		FROM
		    "DNP_PROD"."TB_BOOKING" "A1"
		WHERE
		    "A1"."BOOKING_NO" = #{bookingNo}
		    AND "A1"."USER_VOY" = #{userVoy}
    </select>
    <select id="getOrderNoInInventoryByShipmentDetail" parameterType="ShipmentDetailEntity" resultType="String">
	    SELECT JOB_ODR_NO2
	    FROM DNP_PROD.TB_INVENTORY
	    <where>
	       <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <!-- <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if> -->
	       <if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
	       <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
	       <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	   </where>
    </select>
    <select id="getOrderNoInReserveByShipmentDetail" parameterType="ShipmentDetailEntity" resultType="String">
	    SELECT JOB_ODR_NO
	    FROM DNP_PROD.TB_RESERVE
	    <where>
	       <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
	       <if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
	       <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
	       <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	   </where>
    </select>
    <select id="selectCoordinateOfContainersByShipmentDetail" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
       SELECT            
           CNTR_NO AS containerNo,
           VSL_CD AS vslNm,
           CALL_SEQ AS voyNo,
           FE AS fe,
           PTNR_CODE AS opeCode,
           BOOKING_NO AS bookingNo,
           SZTP2 AS sztp,
           BL_NO AS blNo,
           BLOCK AS block,
           ROWW AS roww,
           BAY AS bay,
           TIER AS tier,
		   JOB_ODR_NO2 AS orderNo,
		   REMARK AS remark
        FROM DNP_PROD.TB_INVENTORY
	    <where>
	       <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
	       <if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
	       <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
	       <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	       <if test="block != null  and block != ''"> and BLOCK = #{block}</if>
	       <if test="bay != null  and bay != ''"> and BAY = #{bay}</if>
	       AND CNTR_STATE = 'Y'
	   </where>
        ORDER BY CNTR_NO ASC
    </select>

	<select id="selectListBlockBySztpOpeCode" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT BLOCK 
		FROM DNP_PROD.TB_INVENTORY
		<where>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	       AND CNTR_STATE = 'Y'
	   </where>
		GROUP BY BLOCK
	</select>

	<select id="selectListBayBySztpOpeCode" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT BAY 
		FROM DNP_PROD.TB_INVENTORY
		<where>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
		   <if test="block != null  and block != ''"> and BLOCK = #{block}</if>
	       AND CNTR_STATE = 'Y'
	   </where>
		GROUP BY BAY
	</select>

	<select id="getTruckerByRegNo" parameterType="String" resultType="String">
		SELECT PTNR_CODE
		FROM DNP_PROD.TB_PTNR
		WHERE TRIM(REG_NO) = #{taxCode}
		    AND UNUSED_CHK = 'N'
		    AND PTNR_TYPE = 'TRK'
		FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getContainerListHoldRelease" parameterType="vn.com.irtech.api.dto.ContainerHoldInfo" resultType="String">
		SELECT CNTR_NO
			FROM DNP_PROD.TB_HOLD_STATE
			<where> 
				CNTR_NO IN 
				<foreach item="container" collection="containers" open="(" separator="," close=")">
					#{container}
				</foreach>
				<if test="userVoy != null and userVoy != ''"> AND USER_VOY = #{userVoy}</if>
				<if test="holdType != null and holdType != ''"> AND HOLD_TYPE = #{holdType}</if>
				<if test="holdCode != null and holdCode != ''"> AND HOLD_CODE = #{holdCode}</if>
				<if test="holdChk != null and holdChk != ''"> AND HOLD_CHK = #{holdChk}</if>
			</where>
        GROUP BY CNTR_NO, HOLD_CHK, USER_VOY, HOLD_TYPE, HOLD_CODE
	</select>

	<select id="getNumberOfConsignee" parameterType="String" resultType="int">
		SELECT COUNT(ENG_SNM)
		FROM DNP_PROD.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND UNUSED_CHK = 'N'
			AND ENG_SNM = #{consignee}
	</select>

	<select id="getNumberOfPod" parameterType="String" resultType="int">
		SELECT 
   			COUNT(POD)
		FROM DNP_PROD.TB_VSL_POD
		WHERE POD = #{pod}
	</select>

    <!-- Get terminal/custom hold list by container_no list and userVoy. TODO: Update resultType -->
    <select id="getContainerHoldList" resultType="String">
        SELECT CNTR_UID, CNTR_NO, HOLD_TYPE, HOLD_CHK, USER_VOY,
               SUBSTR (MAX (SYS_CONNECT_BY_PATH (HOLD_CODE, ',')), 2) HOLD_CODES
        FROM (SELECT CNTR_UID, CNTR_NO, HOLD_TYPE, HOLD_CHK, HOLD_CODE, USER_VOY,
                     ROW_NUMBER () OVER (PARTITION BY CNTR_UID ORDER BY HOLD_CODE) R_NUM
			FROM DNP_PROD.TB_HOLD_STATE
			WHERE HOLD_CHK = 'Y'
				AND CNTR_NO IN 
				<foreach item="container" collection="array" open="(" separator="," close=")">
					#{container}
				</foreach>
				<if test="userVoy != null  and userVoy != ''"> AND USER_VOY = #{userVoy}</if>
				<if test="holdType != null  and holdType != ''"> AND HOLD_TYPE = #{holdType}</if>
			)
        START WITH R_NUM = 1
        CONNECT BY PRIOR R_NUM = R_NUM - 1 AND PRIOR CNTR_UID = CNTR_UID
        GROUP BY CNTR_UID, CNTR_NO, HOLD_CHK, USER_VOY
    </select>

	<select id="getBerthPlanInfo" parameterType="vn.com.irtech.api.dto.BerthPlanInfo" resultType="vn.com.irtech.api.dto.BerthPlanInfo">
		SELECT t.vsl_cd,
		       t.call_seq,
		       t.call_year,
		       t.in_voy,
			   t.longterm_eta,
			   t.etd,
			   t.user_voy,
			   t.ptnr_code
		FROM DNP_PROD.tb_berthplan t
		<where>
			t.vsl_cd NOT IN ('DBO', 'EMPTY', 'STRG', 'TBA', 'DUMY')
			AND t.longterm_eta IS NOT NULL
			AND t.atc IS NULL
			<if test="vslCd != null  and vslCd != ''"> AND vsl_cd = #{vslCd}</if>
			<if test="callSeq != null  and callSeq != ''"> AND call_seq = #{callSeq}</if>
		</where>
		ORDER BY t.vsl_cd ASC
		FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getPartnerInfo" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	ENG_SNM as groupName,
	    	ADDR as address
		FROM DNP_PROD.TB_PTNR
		<where> 
		    AND UNUSED_CHK = 'N' 
		    AND ROWNUM = 1
			<if test="partnerType != null and partnerType != ''"> AND PTNR_TYPE = #{partnerType}</if>
			<if test="taxCode != null and taxCode != ''"> AND TRIM(REG_NO) = #{taxCode}</if>
			<if test="ptnrCode != null and ptnrCode != ''"> AND TRIM(PTNR_CODE) = #{ptnrCode}</if>
		</where>
	</select>

	<select id="selectContainerInfoFromReserve" parameterType="String" resultType="vn.com.irtech.api.dto.ContainerInfoDto">
        <include refid="selectContainerDetailVo"/>
            FROM DNP_PROD.TB_RESERVE M
        <where>
            AND M.CNTR_NO in
			<foreach item="containerNo" collection="array" open="(" separator="," close=")">
				#{containerNo}
			</foreach>
        </where>
    </select>
</mapper>