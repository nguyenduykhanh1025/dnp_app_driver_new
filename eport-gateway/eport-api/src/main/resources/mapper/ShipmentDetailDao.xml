<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vn.com.irtech.api.dao.ShipmentDetailDao">
    <select id="selectShipmentDetailsByBLNo" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE AS opeCode,
                (SELECT VSL_NM FROM TB_VSL WHERE VSL_CD = M.VSL_CD) AS vslNm,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.user_voy AS voyNo,
                M.chold_chk AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus
            FROM  TB_INVENTORY M
        WHERE M.BL_NO = #{blNo}
        ORDER BY M.CNTR_NO ASC
    </select>
    <select id="selectShipmentDetailByContNo" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE AS opeCode,
                (SELECT VSL_NM FROM TB_VSL WHERE VSL_CD = M.VSL_CD) AS vslNm,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.user_voy AS voyNo,
                M.chold_chk AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus
            FROM TB_INVENTORY M
		WHERE CNTR_NO = #{containerNo}
        ORDER BY CNTR_NO ASC
    </select>
    <select id="selectCoordinateOfContainers" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
       SELECT            
                CNTR_NO AS containerNo,
                BL_NO AS blNo,
                ROWW AS roww,
                BAY AS bay,
                TIER AS tier
            FROM TB_INVENTORY
        WHERE BL_NO = #{blNo}
        ORDER BY CNTR_NO ASC
    </select>
    <select id="selectVesselCodeList" resultType="String">
	        SELECT
                VSL_CD AS VSL_CD
        	FROM TB_VSL
	</select>
	<select id="selectPODList"	resultType="String">
			SELECT 
    		CNTRY_CD || PORT_CD || ': ' || PORT_NM AS POD
			FROM TB_PORT
	</select>
	<select id="selectConsigneeList" resultType="String">
			SELECT 
		    ENG_LNM AS CONSIGNEE
			FROM TB_PTNR
	</select>
</mapper>