<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vn.com.irtech.api.dao.ShipmentDetailDao">
    <select id="selectShipmentDetailsByBLNo" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE ||': ' || (SELECT ENG_SNM FROM DNP_UAT.TB_PTNR WHERE PTNR_CODE = M.PTNR_CODE AND PTNR_TYPE = 'SHP') AS opeCode,
                (SELECT VSL_NM FROM DNP_UAT.TB_VSL WHERE VSL_CD = M.VSL_CD) AS vslName,
                M.VSL_CD ||': '|| (SELECT VSL_NM FROM DNP_UAT.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslNm,
                M.CALL_YEAR AS year,
                (SELECT B.IN_VOY FROM DNP_UAT.TB_BERTHPLAN B WHERE B.VSL_CD = M.VSL_CD AND B.CALL_YEAR = M.CALL_YEAR AND B.CALL_SEQ = M.CALL_SEQ) AS voyCarrier,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.CALL_SEQ AS voyNo,
                M.chold_chk AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus,
				REMARK AS containerRemark,
				BLOCK || '-' || BAY || '-' || ROWW || '-' || TIER AS location
            FROM DNP_UAT.TB_INVENTORY M
        WHERE M.BL_NO = #{blNo}
        ORDER BY M.CNTR_NO ASC
    </select>
    
    <select id="selectShipmentDetailByContNo"  resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE ||': ' || (SELECT ENG_SNM FROM DNP_UAT.TB_PTNR WHERE PTNR_CODE = M.PTNR_CODE AND PTNR_TYPE = 'SHP') AS opeCode,
                (SELECT VSL_NM FROM DNP_UAT.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslName,
                M.VSL_CD ||': '|| (SELECT VSL_NM FROM DNP_UAT.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslNm,
                M.CALL_YEAR AS year,
                (SELECT B.IN_VOY FROM DNP_UAT.TB_BERTHPLAN B WHERE B.VSL_CD = M.VSL_CD AND B.CALL_YEAR = M.CALL_YEAR AND B.CALL_SEQ = M.CALL_SEQ) AS voyCarrier,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.CALL_SEQ AS voyNo,
                CASE
                	WHEN M.chold_chk = 'N' then 'R'
                	WHEN M.chold_chk = 'Y' then 'N'
                END AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus,
				REMARK AS containerRemark,
				BLOCK || '-' || BAY || '-' || ROWW || '-' || TIER AS location
			          FROM DNP_UAT.TB_INVENTORY M
		<where>
			<if test="containerNo != null and containerNo != ''"> AND CNTR_NO = #{containerNo}</if>
			<if test="blNo != null and blNo != ''">
				AND BL_NO = #{blNo}
				AND OPR_EXPIRE_DATE IS NULL
				AND JOB_ODR_NO2 IS NULL
				AND IX_CD = 'I'
			</if>
		</where>
		UNION
		SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE ||': ' || (SELECT ENG_SNM FROM DNP_UAT.TB_PTNR WHERE PTNR_CODE = M.PTNR_CODE AND PTNR_TYPE = 'SHP') AS opeCode,
                (SELECT VSL_NM FROM DNP_UAT.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslName,
                M.VSL_CD ||': '|| (SELECT VSL_NM FROM DNP_UAT.TB_VSL V WHERE V.VSL_CD = M.VSL_CD) AS vslNm,
                M.CALL_YEAR AS year,
                (SELECT B.IN_VOY FROM DNP_UAT.TB_BERTHPLAN B WHERE B.VSL_CD = M.VSL_CD AND B.CALL_YEAR = M.CALL_YEAR AND B.CALL_SEQ = M.CALL_SEQ) AS voyCarrier,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.CALL_SEQ AS voyNo,
                CASE
                	WHEN M.chold_chk = 'N' then 'R'
                	WHEN M.chold_chk = 'Y' then 'N'
                END AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus,
				REMARK AS containerRemark,
				BLOCK || '-' || BAY || '-' || ROWW || '-' || TIER AS location
			          FROM DNP_UAT.TB_RESERVE M
		<where>
			<if test="containerNo != null and containerNo != ''"> AND CNTR_NO = #{containerNo}</if>
			<if test="blNo != null and blNo != ''">
				AND BL_NO = #{blNo}
				AND OPR_EXPIRE_DATE IS NULL
				AND JOB_ODR_NO2 IS NULL
				AND IX_CD = 'I'
			</if>
		</where>
		FETCH NEXT 1 ROWS ONLY

    </select>
    
    <select id="selectCoordinateOfContainers" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
       SELECT            
           CNTR_NO AS containerNo,
           BL_NO AS blNo,
           BLOCK AS block,
           ROWW AS roww,
           BAY AS bay,
           TIER AS tier
        FROM DNP_UAT.TB_INVENTORY
        WHERE BL_NO = #{blNo}
        ORDER BY CNTR_NO ASC
    </select>
    
    <select id="selectVesselCodeList" resultType="String">
        SELECT
               VSL_CD||': '||VSL_NM AS VSL_CD
       	FROM DNP_UAT.TB_VSL
	</select>
	
	<select id="selectPODList" parameterType="ShipmentDetailEntity"	resultType="String">
		SELECT 
   			POD || ': ' ||(SELECT PORT_NM FROM DNP_UAT.TB_PORT WHERE CNTRY_CD = SUBSTR(POD, 1, 2) AND PORT_CD = SUBSTR(POD, 3)) AS POD
		FROM DNP_UAT.TB_VSL_POD
		WHERE VSL_CD = #{vslNm} and CALL_SEQ = #{voyNo} and CALL_YEAR = #{year}
		GROUP BY POD
        ORDER BY POD ASC
	</select>
	
	<select id="selectConsigneeList" resultType="String">
		SELECT 
	    	ENG_SNM AS CONSIGNEE
		FROM DNP_UAT.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND REG_NO IS NOT NULL
		    AND UNUSED_CHK = 'N'
	</select>

	<select id="selectConsigneeListWithoutTaxCode" resultType="String">
		SELECT 
	    	ENG_SNM AS CONSIGNEE
		FROM DNP_UAT.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND UNUSED_CHK = 'N'
	</select>
	
	<select id="selectVoyageNoListByVesselCode" parameterType="String" resultType="String">
		SELECT
	    	CALL_SEQ AS VOYAGE
		FROM DNP_UAT.TB_BERTHPLAN
		WHERE VSL_CD = #{vesselCode}
		       AND longterm_eta IS NOT NULL
		       AND atc IS NULL
	    ORDER BY CALL_SEQ ASC
	</select>	
	<select id="selectOpeCodeList" resultType="String">
	    SELECT 
        	PTNR_CODE || ': ' || ENG_SNM AS PTNR_CODE
	    FROM DNP_UAT.TB_PTNR
	    WHERE PTNR_TYPE = 'SHP'
	        AND UNUSED_CHK = 'N'
	        AND PTNR_CODE NOT IN ('000','OWN')
        ORDER BY PTNR_CODE ASC
	</select>
	
	<select id="getGroupNameByTaxCode" parameterType="String" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	ENG_SNM as groupName,
	    	ADDR as address
		FROM DNP_UAT.TB_PTNR
		WHERE TRIM(REG_NO) = #{taxCode}
		    AND UNUSED_CHK = 'N' 
		    AND ROWNUM = 1
	</select>
	<select id="checkContReservedByContainerNos" parameterType="String" resultType="String">
		SELECT 
			CNTR_NO
		FROM DNP_UAT.TB_RESERVE
		WHERE CNTR_STATE != 'D' AND CNTR_NO IN 
		<foreach item="containerNo" collection="array" open="(" separator="," close=")">
           	#{containerNo}
       	</foreach>
	</select>
    <select id="getCountContByBlNo" parameterType="String" resultType="Integer">
		SELECT COUNT(*)
		FROM DNP_UAT.TB_INVENTORY
		WHERE BL_NO = #{blNo}
    </select>
    <select id="getOpeCodeCatosByBlNo" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentEntity">
    	SELECT PTNR_CODE AS opeCode, COUNT(*) AS containerAmount
    	FROM DNP_UAT.TB_INVENTORY
    	   WHERE BL_NO = #{blNo}
    	   GROUP BY PTNR_CODE
		UNION
		SELECT PTNR_CODE AS opeCode, COUNT(*) AS containerAmount
    	FROM DNP_UAT.TB_RESERVE
    	   WHERE BL_NO = #{blNo}
    	   GROUP BY PTNR_CODE
    </select>
    <select id="checkCustomStatus" resultType="java.lang.Boolean">
    	SELECT CASE
    				WHEN HOLD_CHK = 'N' THEN 'true'
    				WHEN HOLD_CHK = 'Y' THEN 'false'
    			END AS HOLD_CHK
    	FROM DNP_UAT.TB_HOLD_STATE
    	WHERE HOLD_TYPE = 'C'
    		AND CNTR_NO = #{containerNo}
    		AND CALL_SEQ = #{voyNo}
    </select>
    <select id="selectVesselCodeBerthPlan" parameterType="String" resultType="String">
		SELECT t.VSL_CD||': '|| (SELECT VSL_NM FROM DNP_UAT.TB_VSL WHERE VSL_CD = t.VSL_CD) AS VSL_CD
		  FROM DNP_UAT.tb_berthplan t
		WHERE  PTNR_CODE = #{opeCode}
		       AND t.vsl_cd NOT IN ('DBO','EMTY',
		                            'STRG',
		                            'TBA',
		                            'DUMY')
		       AND t.longterm_eta IS NOT NULL
		       AND t.atc IS NULL
		GROUP BY VSL_CD
        ORDER BY VSL_CD ASC
	</select>
	<select id="selectVesselVoyageBerthPlan" parameterType="String" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
		SELECT t.vsl_cd as vslNm,
		       t.call_seq as voyNo,
		       t.call_year as year,
		       t.in_voy as voyCarrier,
			   t.longterm_eta as eta,
		       t.vsl_cd || ' - ' || (select vsl_nm FROM DNP_UAT.tb_vsl where vsl_cd = t.vsl_cd) ||' - '|| t.in_voy as vslAndVoy
		 FROM DNP_UAT.tb_berthplan t
		 where t.ptnr_code = #{opeCode}
		 		 			    AND   t.vsl_cd NOT IN ('DBO','EMPTY',
			                            'STRG',
			                            'TBA',
			                            'DUMY')
			       AND t.longterm_eta IS NOT NULL
			       AND t.atc IS NULL
		 ORDER BY t.vsl_cd ASC
	</select>
	<select id="getYearByVslCodeAndVoyNo" resultType="String">
		SELECT CALL_YEAR
		  FROM DNP_UAT.tb_berthplan t
		WHERE  VSL_CD = #{vesselCode} and CALL_SEQ = #{voyNo}
		       AND t.vsl_cd NOT IN ('DBO','EMTY',
		                            'STRG',
		                            'TBA',
		                            'DUMY')
		       AND t.longterm_eta IS NOT NULL
		       AND t.atc IS NULL
	</select>
	<select id="selectOpeCodeListInBerthPlan" resultType="String">
			SELECT t.PTNR_CODE || ': ' || (SELECT ENG_SNM FROM DNP_UAT.TB_PTNR WHERE PTNR_CODE = t.PTNR_CODE AND ROWNUM = 1) AS PTNR_CODE
			FROM DNP_UAT.tb_berthplan t
			WHERE
			       t.vsl_cd NOT IN ('DBO','EMPTY',
			                            'STRG',
			                            'TBA',
			                            'DUMY')
			       AND t.longterm_eta IS NOT NULL
			       AND t.atc IS NULL
			 GROUP BY PTNR_CODE
	</select>
	<select id="checkBookingNoForSendFReceiveE" resultType="Integer">
			SELECT COUNT(*)
			FROM DNP_UAT.TB_BOOKING
			WHERE BOOKING_NO = #{bookingNo} AND FE = #{fe}
	</select>
	<select id="getInforSendFReceiveE" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
		SELECT  BO.VSL_CD as vslNm,
		        BO.CALL_YEAR as year,
		        BO.CALL_SEQ as voyNo,
		        BO.PTNR_CODE as opeCode,
		        BO.POD || ': ' ||(SELECT PORT_NM FROM DNP_UAT.TB_PORT WHERE CNTRY_CD = SUBSTR(BO.POD, 1, 2) AND PORT_CD = SUBSTR(BO.POD, 3)) as dischargePort,
		        BO.CARGO_TYPE as cargoType,
		        BO.SZTP2 as sztp,
		        BO.VSL_CD || ' - ' || (SELECT VSL_NM FROM DNP_UAT.TB_VSL WHERE VSL_CD = BO.VSL_CD ) || ' - ' || 
		        (SELECT B.IN_VOY
		         FROM DNP_UAT.TB_BERTHPLAN B
		         WHERE
		            B.VSL_CD = BO.VSL_CD AND
		            B.CALL_YEAR = BO.CALL_YEAR AND
		            B.CALL_SEQ = BO.CALL_SEQ AND
		            B.PTNR_CODE = BO.PTNR_CODE) as vslAndVoy
		FROM DNP_UAT.TB_BOOKING BO
		WHERE BO.BOOKING_NO = #{bookingNo} AND BO.SZTP2 = #{sztp} AND BO.PTNR_CODE = #{opeCode} AND BO.FE = #{fe}
	</select>
	<select id="getIndexContMasterForSSRByContainerNo" parameterType="String" resultType="Date">
		SELECT IN_DATE FROM DNP_UAT.TB_MASTER
		WHERE CNTR_NO = #{containerNo}
	</select>
	<select id="getIndexBooking" parameterType="ShipmentDetailEntity" resultType="ShipmentDetailEntity">
		SELECT 
		    VSL_CD AS vslNm,
		    CALL_SEQ AS voyNo,
		    BOOKING_NO AS bookingNo,
		    PTNR_CODE AS opeCode,
		    SZTP2 AS sztp
		FROM DNP_UAT.TB_BOOKING
		WHERE VSL_CD = #{vslNm} AND
		      CALL_SEQ = #{voyNo} AND
		      CALL_YEAR = #{year}
	</select>
	<select id="getLocationForReceiveF" resultType="ShipmentDetailEntity">
	       SELECT            
           CNTR_NO AS containerNo,
           BL_NO AS blNo,
           BLOCK AS block,
           ROWW AS roww,
           BAY AS bay,
           TIER AS tier
        FROM DNP_UAT.TB_INVENTORY
        WHERE BL_NO = #{blNo} AND CNTR_NO = #{containerNo}
	</select>
	<select id="checkContainerStatus" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT 
			CASE
				WHEN CNTR_STATE = 'R' THEN 'Before Reconcile'
				WHEN CNTR_STATE = 'B' THEN 'After Reconcile'
				WHEN CNTR_STATE = 'M' THEN 'Manifested'
				WHEN CNTR_STATE = 'Y' THEN 'Stacking'
				WHEN CNTR_STATE = 'G' THEN 'In Progress Outgoing'
				WHEN CNTR_STATE = 'O' THEN 'In Progress Incoming'
				WHEN CNTR_STATE = 'P' THEN 'Assigned by Trucker'
				WHEN CNTR_STATE = 'Z' THEN 'Under Shifting'
				WHEN CNTR_STATE = 'D' THEN 'Delivered'
				WHEN CNTR_STATE = 'E' THEN 'Empty Gate Out'
				ELSE CNTR_STATE
			END AS containerStatus
		FROM DNP_UAT.TB_MASTER
		<where>
			<if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
			<if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
			<if test="fe != null  and fe != ''"> and FE = #{fe}</if>
			<if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
			<if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
			<if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
			<if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
			<if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
		</where>
	</select>
	<select id="getBlockList" parameterType="String" resultType="String">
		SELECT BLOCK FROM DNP_UAT.TB_BLOCK
        WHERE BLOCK like concat(concat('%', #{keyword}), '%')
	</select>
	<select id="getAreaList" parameterType="String" resultType="String">
		SELECT AREA FROM DNP_UAT.TB_AREA
        WHERE AREA like concat(concat('%', #{keyword}), '%')
        ORDER BY AREA
	</select>
	<select id="checkContReserved" parameterType="ShipmentDetailEntity" resultType="ShipmentDetailEntity">
		SELECT 
			CNTR_NO AS containerNo,
			BOOKING_NO AS bookingNo,
			PTNR_CODE AS opeCode,
			VSL_CD AS vslNm,
			CALL_SEQ AS voyNo,
			SZTP2 AS sztp
		FROM DNP_UAT.TB_RESERVE 
         <where>
            <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
            <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
            <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
            <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
            <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
            <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
            <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
        </where>
	</select>
	<select id="checkTheNumberOfContainersNotOrderedForReceiveContEmpty" resultType="Integer">
		SELECT
		    (SELECT BOOK_QTY FROM DNP_UAT.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}) - COUNT(*) AS RESULT
		FROM DNP_UAT.TB_INVENTORY
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'E' AND SZTP2 = #{sztp} AND JOB_ODR_NO2 IS NOT NULL
		GROUP BY BOOKING_NO
	</select>

	<select id="checkTheNumberOfContainersOrderedForReceiveContEmpty" resultType="Integer">
		SELECT
		    (SELECT BOOK_QTY FROM DNP_UAT.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}) - COUNT(*) AS RESULT
		FROM DNP_UAT.TB_INVENTORY
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'E' AND SZTP2 = #{sztp}
		GROUP BY BOOKING_NO
	</select>

	<select id="checkTheNumberOfContainersNotOrderedForSendContFull" resultType="Integer">
		SELECT
		    (SELECT BOOK_QTY FROM DNP_UAT.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}) - COUNT(*) AS RESULT
		FROM DNP_UAT.TB_RESERVE
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'F' AND SZTP2 = #{sztp} AND JOB_ODR_NO IS NOT NULL
		GROUP BY BOOKING_NO
	</select>

	<select id="selectBookingQuantity" resultType="int"> 
		SELECT BOOK_QTY FROM DNP_UAT.TB_BOOKING B WHERE B.BOOKING_NO = #{bookingNo} AND B.SZTP2 = #{sztp}
	</select>

	<select id="selectBookingOrderEmptyQuantity" resultType="int">
		SELECT COUNT(*) 
		FROM DNP_UAT.TB_INVENTORY
		WHERE BOOKING_NO = #{bookingNo} AND FE = 'E' AND SZTP2 = #{sztp} AND JOB_ODR_NO2 IS NOT NULL
	</select>
	
	<select id="selectConsigneeTaxCode" parameterType="vn.com.irtech.api.dto.PartnerInfoDto" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	CONCAT(TRIM(REG_NO) ,CONCAT(': ',ENG_LNM)) as groupName,
	    	TRIM(REG_NO) AS taxCode
		FROM DNP_UAT.TB_PTNR
		<where>
			REG_NO IS NOT NULL
			AND UNUSED_CHK = 'N'
			<if test="groupName != null  and groupName != ''"> AND UPPER(CONCAT(TRIM(REG_NO) ,CONCAT(': ',ENG_LNM))) LIKE CONCAT(CONCAT('%', #{groupName}), '%')</if>
		</where>
		GROUP BY ENG_LNM, REG_NO
	</select>

	<select id="getSztpByContainerNoMaster" parameterType="String" resultType="String">
		SELECT SZTP
		FROM DNP_UAT.TB_MASTER
		WHERE CNTR_NO = #{containerNo}
		fetch next 1 rows only
	</select>

	<select id="getSztpByContainerNoInventory" parameterType="String" resultType="String">
		SELECT SZTP
		FROM DNP_UAT.TB_INVENTORY
		WHERE CNTR_NO = #{containerNo}
		fetch next 1 rows only
	</select>

	<select id="getTaxCodeBySnmGroupName" parameterType="String" resultType="String">
		SELECT 
	    	TRIM(REG_NO) AS TAXCODE
		FROM DNP_UAT.TB_PTNR 
		WHERE PTNR_TYPE = 'CNS'
		    AND ENG_SNM = #{consignee}
		    AND UNUSED_CHK = 'N'
        FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getblNoByJobOrderNo" parameterType="String" resultType="String">
		SELECT 
			BL_NO
		FROM DNP_UAT.TB_INVENTORY
		WHERE JOB_ODR_NO2 = #{jobOrdNo2}
		FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getConsigneeByTaxCode" parameterType="String" resultType="vn.com.irtech.api.dto.PartnerInfoDto">
		SELECT
	    	ENG_SNM as groupName,
	    	ADDR as address
		FROM DNP_UAT.TB_PTNR
		WHERE PTNR_TYPE = 'CNS' 
		    AND UNUSED_CHK = 'N'
		    AND TRIM(REG_NO) = #{taxCode} AND ROWNUM = 1
	</select>

	<select id="getOprCodeList" resultType	="String">
		SELECT PTNR_CODE 
		  FROM DNP_UAT.TB_PTNR 
		  WHERE PTNR_TYPE = 'SHP' 
		      AND PTNR_CODE NOT IN ('000','OWN')
		      AND UNUSED_CHK = 'N'
	</select>

	<select id="selectVesselVoyageBerthPlanWithoutOpe" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
		SELECT t.vsl_cd as vslNm,
		       t.call_seq as voyNo,
		       t.call_year as year,
		       t.in_voy as voyCarrier,
			   t.longterm_eta as eta,
			   t.etd as etd,
		       t.vsl_cd || ' - ' || (select vsl_nm FROM DNP_UAT.tb_vsl where vsl_cd = t.vsl_cd) ||' - '|| t.in_voy as vslAndVoy
		 FROM DNP_UAT.tb_berthplan t
		 where t.vsl_cd NOT IN ('DBO','EMPTY',
			                            'STRG',
			                            'TBA',
			                            'DUMY')
			       AND t.longterm_eta IS NOT NULL
			       AND t.atc IS NULL
         ORDER BY t.vsl_cd ASC
	</select>
	
	<select id="getBookingInfo" resultType="vn.com.irtech.api.form.BookingInfo">
        SELECT
		    USER_VOY as userVoy,
		    BOOKING_NO as bookingNo,
		    SZTP as sztp,
		    BOOK_QTY as bookQty,
		    (
		        SELECT
		            COUNT(*)
		        FROM
		            "DNP_UAT"."TB_INVENTORY" "A2"
		        WHERE
		            "A2"."BOOKING_NO" = "A1"."BOOKING_NO"
		            AND "A2"."SZTP" = "A1"."SZTP"
		            AND "A2"."JOB_ODR_NO2" IS NOT NULL
		    ) usedQty
		FROM
		    "DNP_UAT"."TB_BOOKING" "A1"
		WHERE
		    "A1"."BOOKING_NO" = #{bookingNo}
		    AND "A1"."USER_VOY" = #{userVoy}
    </select>
    <select id="getOrderNoInInventoryByShipmentDetail" parameterType="ShipmentDetailEntity" resultType="String">
	    SELECT JOB_ODR_NO2
	    FROM DNP_UAT.TB_INVENTORY
	    <where>
	       <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <!-- <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if> -->
	       <if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
	       <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
	       <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	   </where>
    </select>
    <select id="getOrderNoInReserveByShipmentDetail" parameterType="ShipmentDetailEntity" resultType="String">
	    SELECT JOB_ODR_NO
	    FROM DNP_UAT.TB_RESERVE
	    <where>
	       <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
	       <if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
	       <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
	       <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	   </where>
    </select>
    <select id="selectCoordinateOfContainersByShipmentDetail" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
       SELECT            
           CNTR_NO AS containerNo,
           VSL_CD AS vslNm,
           CALL_SEQ AS voyNo,
           FE AS fe,
           PTNR_CODE AS opeCode,
           BOOKING_NO AS bookingNo,
           SZTP2 AS sztp,
           BL_NO AS blNo,
           BLOCK AS block,
           ROWW AS roww,
           BAY AS bay,
           TIER AS tier,
		   JOB_ODR_NO2 AS orderNo,
		   REMARK AS remark
        FROM DNP_UAT.TB_INVENTORY
	    <where>
	       <if test="containerNo != null  and containerNo != ''"> and CNTR_NO = #{containerNo}</if>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="bookingNo != null  and bookingNo != ''"> and BOOKING_NO = #{bookingNo}</if>
	       <if test="blNo != null  and blNo != ''"> and BL_NO = #{blNo}</if>
	       <if test="vslNm != null  and vslNm != ''"> and VSL_CD = #{vslNm}</if>
	       <if test="voyNo != null  and voyNo != ''"> and CALL_SEQ = #{voyNo}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	       <if test="block != null  and block != ''"> and BLOCK = #{block}</if>
	       <if test="bay != null  and bay != ''"> and BAY = #{bay}</if>
	       AND CNTR_STATE = 'Y'
	   </where>
        ORDER BY CNTR_NO ASC
    </select>

	<select id="selectListBlockBySztpOpeCode" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT BLOCK 
		FROM DNP_UAT.TB_INVENTORY
		<where>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
	       AND CNTR_STATE = 'Y'
	   </where>
		GROUP BY BLOCK
	</select>

	<select id="selectListBayBySztpOpeCode" parameterType="ShipmentDetailEntity" resultType="String">
		SELECT BAY 
		FROM DNP_UAT.TB_INVENTORY
		<where>
	       <if test="sztp != null  and sztp != ''"> and SZTP2 = #{sztp}</if>
	       <if test="fe != null  and fe != ''"> and FE = #{fe}</if>
	       <if test="opeCode != null  and opeCode != ''"> and PTNR_CODE = #{opeCode}</if>
		   <if test="block != null  and block != ''"> and BLOCK = #{block}</if>
	       AND CNTR_STATE = 'Y'
	   </where>
		GROUP BY BAY
	</select>

	<select id="getTruckerByRegNo" parameterType="String" resultType="String">
		SELECT PTNR_CODE
		FROM DNP_UAT.TB_PTNR
		WHERE TRIM(REG_NO) = #{taxCode}
		    AND UNUSED_CHK = 'N'
		FETCH NEXT 1 ROWS ONLY
	</select>

	<select id="getContainerListNoneTerminalHold" resultType="String">
		select CNTR_NO
		FROM DNP_UAT.TB_INVENTORY
		WHERE CNTR_NO IN 
		<foreach item="container" collection="array" open="(" separator="," close=")">
            #{container}
        </foreach>
		AND THOLD_CHK != 'Y'
	</select>
</mapper>