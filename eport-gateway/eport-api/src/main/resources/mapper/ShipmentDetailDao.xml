<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vn.com.irtech.api.dao.ShipmentDetailDao">
    <select id="selectShipmentDetailsByBLNo" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE AS opeCode,
                (SELECT VSL_NM FROM TB_VSL WHERE VSL_CD = M.VSL_CD) AS vslNm,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.user_voy AS voyNo,
                M.chold_chk AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE2 = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus
            FROM (SELECT 'TB_INVENTORY'
                            TABLE_NAME,
                        M.VSL_CD,
                        M.SO_NO,
                        M.CNTR_NO,
                        FE,
                        IX_CD,
                        PTNR_CODE,
                        SHIFT_ACC,
                        SZTP,
                        SZTP2,
                        FDEST,
                        DELV,
                        WGT,
                        DMG_COND,
                        POD,
                        SF_GET_WEIGHT_GROUP (M.OUT_LANE,
                                            M.VSL_CD,
                                            M.SZTP2,
                                            M.WGT)
                            WGT_GRP,
                        SUBSTR (M.SZTP2, 1, 1)
                            AS CNTR_LEN,
                        SUBSTR (M.SZTP2, 2, 1)
                            AS CNTR_HW,
                        SUBSTR (M.SZTP2, 3, 2)
                            AS CNTR_TYPE,
                        SEAL_NO1,
                        SEAL_NO2,
                        BOOKING_NO,
                        BL_NO,
                        O.OV_HEIGHT,
                        O.OV_FORE,
                        O.OV_AFT,
                        O.OV_PORT,
                        O.OV_STBD,
                        NULL
                            OS_HEIGHT,
                        NULL
                            OS_PORT,
                        NULL
                            OS_STBD,
                        TRUCKER,
                        TRANS_TYPE,
                        M.TRANS_TYPE2,
                        PREV_VSL,
                        PREV_YEAR,
                        PREV_SEQ,
                        REMARK,
                        M.IN_TMNL_DATE,
                        M.IN_DATE,
                        M.OUT_DATE,
                        M.DISPATCH_MODE,
                        M.DISPATCH_MODE2,
                        M.JOB_ODR_NO,
                        M.JOB_ODR_NO2,
                        USER_VOY,
                        NVL (EMTY_CHK, 'N')
                            AS EMTY_CHK,
                        AREA,
                        STORAGE_CODE,
                        COD,
                        POL,
                        FPOD,
                        CNTR_STATE,
                        EDI_TEMP,
                        PREV_USER_VOY,
                        SHIFT_TIME,
                        SHIFT_TYPE,
                        SHIFT_RSN,
                        CONSIGNEE,
                        SEAL_NO3,
                        CHOLD_CHK,
                        NVL (THOLD_CHK, 'N')
                            AS THOLD_CHK,
                        IN_LANE,
                        OUT_LANE,
                        SOC_CHK,
                        NVL (DG_CHK, 'N')
                            AS DG_CHK,
                        RETURN_RSN,
                        NVL (DOMESTIC_CHK, 'N')
                            AS DOMESTIC_CHK,
                        LBAY,
                        LROW,
                        LTIER,
                        DBAY,
                        DROW,
                        DTIER,
                        BLOCK,
                        BAY,
                        ROWW,
                        TIER,
                        OWNER,
                        GWAY,
                        HANDLE_INSTR,
                        YHANDLE_INSTR,
                        YSPECIAL_TYPE,
                        ABS_CONST,
                        TRN_VOY,
                        TRN_VOY2,
                        TRUCKER2,
                        TRUCK_NO,
                        TRUCK_NO2,
                        UNPLUG_INSTR,
                        CNTR_COND,
                        DEFECTIVE_CODE,
                        CLEAN_CODE,
                        POWER_CODE,
                        NVL (M.REHANDLE_CODE, 'U')
                            AS REHANDLE_CODE,
                        REHANDLE_RSN,
                        REHANDLE_STAFF,
                        LCL_FCL,
                        DHD,
                        LHD,
                        DHATCH_IDX,
                        LHATCH_IDX,
                        NVL (M.DMG_CHK, 'N')
                            AS DMG_CHK,
                        STUFF_CHK,
                        NVL (M.OVERLAND_CHK, 'N')
                            AS OVERLAND_CHK,
                        NVL (M.RELEASE_CHK, 'N')
                            AS RELEASE_CHK,
                        NVL (INSPECT_CHK, 'N')
                            AS INSPECT_CHK,
                        FORWARDER,
                        COMMODITY,
                        DEQU_NO,
                        LEQU_NO,
                        PREINFO_CHK,
                        LBAY_SEQ,
                        BAY_IDX,
                        ROW_IDX,
                        M.CNTR_ID,
                        M.CNTR_UID,
                        TO_NUMBER (
                            TRUNC (NVL (M.OUT_DATE, SYSDATE))
                            - TRUNC (NVL (M.IN_TMNL_DATE, M.IN_DATE))
                            + 1)
                            AS STACK_DAYS,
                        CEIL (
                            NVL (M.OUT_DATE, SYSDATE)
                            - NVL (M.IN_TMNL_DATE, M.IN_DATE))
                            AS STACK_DAYS_D24,
                        M.DBAY || M.DROW || M.DTIER
                            AS SHIP_LOCD,
                        M.LBAY || M.LROW || M.LTIER
                            AS SHIP_LOCL,
                        M.VGM,
                        M.VGM_CHK,
                        M.CUSTOM_APP_TYPE,
                        M.COMMODITY_DESC,
                        M.CONSIGNEE_NM,
                        M.CNTR_RMK1,
                        M.DOOR_DIR
                    FROM TB_INVENTORY M, TB_OVERSIZE O
                WHERE M.CNTR_ID = O.CNTR_ID(+)) M
        WHERE     M.BL_NO = #{blNo}
        ORDER BY M.CNTR_NO ASC
    </select>
    <select id="selectShipmentDetailByContNo" parameterType="ShipmentDetailEntity" resultType="vn.com.irtech.api.entity.ShipmentDetailEntity">
        SELECT            
                M.CNTR_NO AS containerNo,
                M.SZTP2 AS sztp,
                M.FE AS fe,
                M.PTNR_CODE AS opeCode,
                (SELECT VSL_NM FROM TB_VSL WHERE VSL_CD = M.VSL_CD) AS vslNm,
                M.BOOKING_NO AS bookingNo,
                M.BL_NO AS blNo,
                M.SEAL_NO1 AS sealNo,
                M.WGT AS wgt,
                M.CONSIGNEE AS consignee,
                M.VGM AS vgm,
                M.user_voy AS voyNo,
                M.chold_chk AS customStatus,
                M.POD AS dischargePort,
                M.POL AS loadingPort,
                CASE
                    WHEN M.TRANS_TYPE = 'T' THEN 'Truck'
                    WHEN M.TRANS_TYPE = 'V' THEN 'Vessel'
                    WHEN M.TRANS_TYPE = 'C' THEN 'CFS'
                    WHEN M.TRANS_TYPE = 'P' THEN 'Bundle'
                    WHEN M.TRANS_TYPE2 = 'M' THEN 'Mode change'
                    ELSE M.TRANS_TYPE
                END AS transportType,           
                
                CASE
                    WHEN M.CNTR_STATE = 'R' THEN 'Before Reconcile'
                    WHEN M.CNTR_STATE = 'B' THEN 'After Reconcile'
                    WHEN M.CNTR_STATE = 'M' THEN 'Manifested'
                    WHEN M.CNTR_STATE = 'Y' THEN 'Stacking'
                    WHEN M.CNTR_STATE = 'G' THEN 'In Progress Outgoing'
                    WHEN M.CNTR_STATE = 'O' THEN 'In Progress Incoming'
                    WHEN M.CNTR_STATE = 'P' THEN 'Assigned by Trucker'
                    WHEN M.CNTR_STATE = 'Z' THEN 'Under Shifting'
                    WHEN M.CNTR_STATE = 'D' THEN 'Delivered'
                    WHEN M.CNTR_STATE = 'E' THEN 'Empty Gate Out'
                    ELSE M.CNTR_STATE
                END AS containerStatus
            FROM (SELECT 'TB_INVENTORY'
                            TABLE_NAME,
                        M.VSL_CD,
                        M.SO_NO,
                        M.CNTR_NO,
                        FE,
                        IX_CD,
                        PTNR_CODE,
                        SHIFT_ACC,
                        SZTP,
                        SZTP2,
                        FDEST,
                        DELV,
                        WGT,
                        DMG_COND,
                        POD,
                        SF_GET_WEIGHT_GROUP (M.OUT_LANE,
                                            M.VSL_CD,
                                            M.SZTP2,
                                            M.WGT)
                            WGT_GRP,
                        SUBSTR (M.SZTP2, 1, 1)
                            AS CNTR_LEN,
                        SUBSTR (M.SZTP2, 2, 1)
                            AS CNTR_HW,
                        SUBSTR (M.SZTP2, 3, 2)
                            AS CNTR_TYPE,
                        SEAL_NO1,
                        SEAL_NO2,
                        BOOKING_NO,
                        BL_NO,
                        O.OV_HEIGHT,
                        O.OV_FORE,
                        O.OV_AFT,
                        O.OV_PORT,
                        O.OV_STBD,
                        NULL
                            OS_HEIGHT,
                        NULL
                            OS_PORT,
                        NULL
                            OS_STBD,
                        TRUCKER,
                        TRANS_TYPE,
                        M.TRANS_TYPE2,
                        PREV_VSL,
                        PREV_YEAR,
                        PREV_SEQ,
                        REMARK,
                        M.IN_TMNL_DATE,
                        M.IN_DATE,
                        M.OUT_DATE,
                        M.DISPATCH_MODE,
                        M.DISPATCH_MODE2,
                        M.JOB_ODR_NO,
                        M.JOB_ODR_NO2,
                        USER_VOY,
                        NVL (EMTY_CHK, 'N')
                            AS EMTY_CHK,
                        AREA,
                        STORAGE_CODE,
                        COD,
                        POL,
                        FPOD,
                        CNTR_STATE,
                        EDI_TEMP,
                        PREV_USER_VOY,
                        SHIFT_TIME,
                        SHIFT_TYPE,
                        SHIFT_RSN,
                        CONSIGNEE,
                        SEAL_NO3,
                        CHOLD_CHK,
                        NVL (THOLD_CHK, 'N')
                            AS THOLD_CHK,
                        IN_LANE,
                        OUT_LANE,
                        SOC_CHK,
                        NVL (DG_CHK, 'N')
                            AS DG_CHK,
                        RETURN_RSN,
                        NVL (DOMESTIC_CHK, 'N')
                            AS DOMESTIC_CHK,
                        LBAY,
                        LROW,
                        LTIER,
                        DBAY,
                        DROW,
                        DTIER,
                        BLOCK,
                        BAY,
                        ROWW,
                        TIER,
                        OWNER,
                        GWAY,
                        HANDLE_INSTR,
                        YHANDLE_INSTR,
                        YSPECIAL_TYPE,
                        ABS_CONST,
                        TRN_VOY,
                        TRN_VOY2,
                        TRUCKER2,
                        TRUCK_NO,
                        TRUCK_NO2,
                        UNPLUG_INSTR,
                        CNTR_COND,
                        DEFECTIVE_CODE,
                        CLEAN_CODE,
                        POWER_CODE,
                        NVL (M.REHANDLE_CODE, 'U')
                            AS REHANDLE_CODE,
                        REHANDLE_RSN,
                        REHANDLE_STAFF,
                        LCL_FCL,
                        DHD,
                        LHD,
                        DHATCH_IDX,
                        LHATCH_IDX,
                        NVL (M.DMG_CHK, 'N')
                            AS DMG_CHK,
                        STUFF_CHK,
                        NVL (M.OVERLAND_CHK, 'N')
                            AS OVERLAND_CHK,
                        NVL (M.RELEASE_CHK, 'N')
                            AS RELEASE_CHK,
                        NVL (INSPECT_CHK, 'N')
                            AS INSPECT_CHK,
                        FORWARDER,
                        COMMODITY,
                        DEQU_NO,
                        LEQU_NO,
                        PREINFO_CHK,
                        LBAY_SEQ,
                        BAY_IDX,
                        ROW_IDX,
                        M.CNTR_ID,
                        M.CNTR_UID,
                        TO_NUMBER (
                            TRUNC (NVL (M.OUT_DATE, SYSDATE))
                            - TRUNC (NVL (M.IN_TMNL_DATE, M.IN_DATE))
                            + 1)
                            AS STACK_DAYS,
                        CEIL (
                            NVL (M.OUT_DATE, SYSDATE)
                            - NVL (M.IN_TMNL_DATE, M.IN_DATE))
                            AS STACK_DAYS_D24,
                        M.DBAY || M.DROW || M.DTIER
                            AS SHIP_LOCD,
                        M.LBAY || M.LROW || M.LTIER
                            AS SHIP_LOCL,
                        M.VGM,
                        M.VGM_CHK,
                        M.CUSTOM_APP_TYPE,
                        M.COMMODITY_DESC,
                        M.CONSIGNEE_NM,
                        M.CNTR_RMK1,
                        M.DOOR_DIR
                    FROM TB_INVENTORY M, TB_OVERSIZE O
                WHERE M.CNTR_ID = O.CNTR_ID(+)) M
        WHERE     M.CNTR_NO = #{containerNo}
        ORDER BY M.CNTR_NO ASC
    </select>
</mapper>