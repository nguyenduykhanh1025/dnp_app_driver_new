<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="vn.com.irtech.api.dao.ContainerInfoDao">

    <select id="selectContainerInfoList" parameterType="ContainerInfoEntity" resultType="vn.com.irtech.api.entity.ContainerInfoEntity">
        SELECT M.VSL_CD,
         M.CALL_YEAR,
         M.CALL_SEQ,
         M.USER_VOY,
         M.SO_NO,
         (SELECT VSL_NM FROM TB_VSL WHERE VSL_CD = M.VSL_CD) AS VSL_NM, 
         M.CNTR_NO, 
         M.CNTR_STATE,
         M.FE,
         M.IX_CD,
         M.PTNR_CODE,
         M.SHIFT_ACC,
         M.BLOCK, 
         M.BAY, 
         M.ROWW, 
         M.TIER, 
         M.WGT_GRP,
         M.CNTR_LEN,
         M.CNTR_HW,
         M.SZTP,
         M.CNTR_TYPE,
         M.SZTP2,
         M.POR,
         M.POD,
         M.FDEST,
         M.COD,
         M.POL,
         M.FPOD,
         M.DELV,
         M.WGT, 
         M.CARGO_TYPE,
         M.SET_TEMP,
         M.AIRVENT,
         SF_GET_IMDG ('IMDG', M.CNTR_ID, M.IMDG) IMDG,
         SF_GET_IMDG ('UNNO', M.CNTR_ID, M.IMDG) UNNO,
         SF_GET_IMDG ('PACKING_GRP', M.CNTR_ID, M.IMDG) PACKING_GRP,
         SF_GET_IMDG ('FIRE_CODE', M.CNTR_ID, M.IMDG) FIRE_CODE,
         M.DMG_COND,
         M.SEAL_NO1,
         M.SEAL_NO2,
         M.SEAL_NO3,
         M.BOOKING_NO, 
         M.BL_NO, 
         M.OV_HEIGHT,
         M.OV_FORE,
         M.OV_AFT,
         M.OV_PORT,
         M.OV_STBD,
         M.OS_HEIGHT,
         M.OS_PORT,
         M.OS_STBD,
         M.TRUCKER,
         M.TRANS_TYPE,
         M.TRANS_TYPE2,
         M.REMARK, 
         M.DISPATCH_MODE, 
         M.DISPATCH_MODE2, 
         M.JOB_ODR_NO,
         M.JOB_ODR_NO2,
         PREV_VSL,
         PREV_YEAR,
         PREV_SEQ,
         PREV_USER_VOY,
         M.EMTY_CHK,
         M.AREA,
         M.STORAGE_CODE,
         M.EDI_TEMP,
         M.PREV_USER_VOY,
         M.SHIFT_TIME,
         M.SHIFT_TYPE,
         M.SHIFT_RSN,
         M.CONSIGNEE, 
         M.CHOLD_CHK,
         M.THOLD_CHK,
         M.IN_LANE,
         M.OUT_LANE,
         M.SOC_CHK,
         M.DG_CHK,
         M.RETURN_RSN,
         M.DOMESTIC_CHK,
         M.LBAY,
         M.LROW,
         M.LTIER,
         M.DBAY,
         M.DROW,
         M.DTIER,
         M.BLOCK,
         M.BAY,
         M.ROWW,
         M.TIER,
         M.OWNER,
         M.GWAY,
         M.HANDLE_INSTR,
         M.YHANDLE_INSTR,
         M.YSPECIAL_TYPE,
         M.ABS_CONST,
         M.TRN_VOY,
         M.TRN_VOY2,
         M.TRUCKER2,
         M.TRUCK_NO,
         M.TRUCK_NO2,
         M.UNPLUG_INSTR,
         M.CNTR_COND,
         M.DEFECTIVE_CODE,
         M.CLEAN_CODE,
         M.POWER_CODE,
         M.REHANDLE_CODE,
         M.REHANDLE_RSN,
         M.REHANDLE_STAFF,
         M.LCL_FCL,
         M.DHD,
         M.DHATCH_IDX,
         M.LHD,
         M.LHATCH_IDX,
         M.DMG_CHK,
         M.STUFF_CHK,
         M.OVERLAND_CHK,
         M.RELEASE_CHK,
         M.INSPECT_CHK,
         M.DEQU_NO,
         M.LEQU_NO,
         M.FORWARDER,
         M.COMMODITY,
         M.STACK_DAYS,
         M.STACK_DAYS_D24,
         M.PREINFO_CHK,
         M.LBAY_SEQ,
         M.BAY_IDX,
         M.ROW_IDX,
         M.CNTR_ID,
         M.CNTR_UID,
         M.IN_DATE, 
         M.OUT_DATE, 
         M.IN_TMNL_DATE,
         M.VGM, 
         M.VGM_CHK,
         B.IN_VOY,
         B.OUT_VOY,
         M.CUSTOM_APP_TYPE,
         M.COMMODITY_DESC,
         M.CONSIGNEE_NM,
         H.THOLD_CODES,
         B.ATB,
         M.CNTR_RMK1
    FROM (SELECT 'TB_INVENTORY' TABLE_NAME,
                 M.VSL_CD,
                 M.CALL_YEAR,
                 M.CALL_SEQ,
                 M.SO_NO,
                 M.CNTR_NO,
                 FE,
                 IX_CD,
                 PTNR_CODE,
                 SHIFT_ACC,
                 SZTP,
                 SZTP2,
                 POR,
                 POD,
                 FDEST,
                 DELV,
                 WGT,
                 CARGO_TYPE,
                 SET_TEMP,
                 AIRVENT,
                 IMDG,
                 UNNO,
                 DMG_COND,
                 SF_GET_WEIGHT_GROUP (M.OUT_LANE,
                                      M.VSL_CD,
                                      M.SZTP2,
                                      M.WGT)
                    WGT_GRP,
                 SUBSTR (M.SZTP2, 1, 1) AS CNTR_LEN,
                 SUBSTR (M.SZTP2, 2, 1) AS CNTR_HW,
                 SUBSTR (M.SZTP2, 3, 2) AS CNTR_TYPE,
                 SEAL_NO1,
                 SEAL_NO2,
                 BOOKING_NO,
                 BL_NO,
                 O.OV_HEIGHT,
                 O.OV_FORE,
                 O.OV_AFT,
                 O.OV_PORT,
                 O.OV_STBD,
                 NULL OS_HEIGHT,
                 NULL OS_PORT,
                 NULL OS_STBD,
                 TRUCKER,
                 TRANS_TYPE,
                 M.TRANS_TYPE2,
                 PREV_VSL,
                 PREV_YEAR,
                 PREV_SEQ,
                 REMARK,
                 M.IN_TMNL_DATE,
                 M.IN_DATE,
                 M.OUT_DATE,
                 M.DISPATCH_MODE,
                 M.DISPATCH_MODE2,
                 M.JOB_ODR_NO,
                 M.JOB_ODR_NO2,
                 USER_VOY,
                 NVL (EMTY_CHK, 'N') AS EMTY_CHK,
                 AREA,
                 STORAGE_CODE,
                 COD,
                 POL,
                 FPOD,
                 CNTR_STATE,
                 EDI_TEMP,
                 PREV_USER_VOY,
                 SHIFT_TIME,
                 SHIFT_TYPE,
                 SHIFT_RSN,
                 CONSIGNEE,
                 SEAL_NO3,
                 CHOLD_CHK,
                 NVL (THOLD_CHK, 'N') AS THOLD_CHK,
                 IN_LANE,
                 OUT_LANE,
                 SOC_CHK,
                 NVL (DG_CHK, 'N') AS DG_CHK,
                 RETURN_RSN,
                 NVL (DOMESTIC_CHK, 'N') AS DOMESTIC_CHK,
                 LBAY,
                 LROW,
                 LTIER,
                 DBAY,
                 DROW,
                 DTIER,
                 BLOCK,
                 BAY,
                 ROWW,
                 TIER,
                 OWNER,
                 GWAY,
                 HANDLE_INSTR,
                 YHANDLE_INSTR,
                 YSPECIAL_TYPE,
                 ABS_CONST,
                 TRN_VOY,
                 TRN_VOY2,
                 TRUCKER2,
                 TRUCK_NO,
                 TRUCK_NO2,
                 UNPLUG_INSTR,
                 CNTR_COND,
                 DEFECTIVE_CODE,
                 CLEAN_CODE,
                 POWER_CODE,
                 NVL (M.REHANDLE_CODE, 'U') AS REHANDLE_CODE,
                 REHANDLE_RSN,
                 REHANDLE_STAFF,
                 LCL_FCL,
                 DHD,
                 LHD,
                 DHATCH_IDX,
                 LHATCH_IDX,
                 NVL (M.DMG_CHK, 'N') AS DMG_CHK,
                 STUFF_CHK,
                 NVL (M.OVERLAND_CHK, 'N') AS OVERLAND_CHK,
                 NVL (M.RELEASE_CHK, 'N') AS RELEASE_CHK,
                 NVL (INSPECT_CHK, 'N') AS INSPECT_CHK,
                 FORWARDER,
                 COMMODITY,
                 DEQU_NO,
                 LEQU_NO,
                 PREINFO_CHK,
                 LBAY_SEQ,
                 BAY_IDX,
                 ROW_IDX,
                 M.CNTR_ID,
                 M.CNTR_UID,
                 TO_NUMBER (
                      TRUNC (NVL (M.OUT_DATE, SYSDATE))
                    - TRUNC (NVL (M.IN_TMNL_DATE, M.IN_DATE))
                    + 1)
                    AS STACK_DAYS,
                 CEIL (
                    NVL (M.OUT_DATE, SYSDATE) - NVL (M.IN_TMNL_DATE, M.IN_DATE))
                    AS STACK_DAYS_D24,
                 M.DBAY || M.DROW || M.DTIER AS SHIP_LOCD,
                 M.LBAY || M.LROW || M.LTIER AS SHIP_LOCL,
                 M.VGM,
                 M.VGM_CHK,
                 M.CUSTOM_APP_TYPE,
                 M.COMMODITY_DESC,
                 M.CONSIGNEE_NM,
                 M.CNTR_RMK1
            FROM TB_INVENTORY M, TB_OVERSIZE O
           WHERE M.CNTR_ID = O.CNTR_ID(+)
          UNION ALL
          SELECT 'TB_MASTER' TABLE_NAME,
                 M.VSL_CD,
                 M.CALL_YEAR,
                 M.CALL_SEQ,
                 M.SO_NO,
                 M.CNTR_NO,
                 FE,
                 IX_CD,
                 PTNR_CODE,
                 SHIFT_ACC,
                 SZTP,
                 SZTP2,
                 POR,
                 POD,
                 FDEST,
                 DELV,
                 WGT,
                 CARGO_TYPE,
                 SET_TEMP,
                 AIRVENT,
                 IMDG,
                 UNNO,
                 DMG_COND,
                 SF_GET_WEIGHT_GROUP (M.OUT_LANE,
                                      M.VSL_CD,
                                      M.SZTP2,
                                      M.WGT)
                    WGT_GRP,
                 SUBSTR (M.SZTP2, 1, 1) AS CNTR_LEN,
                 SUBSTR (M.SZTP2, 2, 1) AS CNTR_HW,
                 SUBSTR (M.SZTP2, 3, 2) AS CNTR_TYPE,
                 SEAL_NO1,
                 SEAL_NO2,
                 BOOKING_NO,
                 BL_NO,
                 O.OV_HEIGHT,
                 O.OV_FORE,
                 O.OV_AFT,
                 O.OV_PORT,
                 O.OV_STBD,
                 NULL OS_HEIGHT,
                 NULL OS_PORT,
                 NULL OS_STBD,
                 TRUCKER,
                 TRANS_TYPE,
                 M.TRANS_TYPE2,
                 PREV_VSL,
                 PREV_YEAR,
                 PREV_SEQ,
                 REMARK,
                 M.IN_TMNL_DATE,
                 M.IN_DATE,
                 M.OUT_DATE,
                 M.DISPATCH_MODE,
                 M.DISPATCH_MODE2,
                 M.JOB_ODR_NO,
                 M.JOB_ODR_NO2,
                 USER_VOY,
                 NVL (EMTY_CHK, 'N') AS EMTY_CHK,
                 AREA,
                 STORAGE_CODE,
                 COD,
                 POL,
                 FPOD,
                 CNTR_STATE,
                 EDI_TEMP,
                 PREV_USER_VOY,
                 SHIFT_TIME,
                 SHIFT_TYPE,
                 SHIFT_RSN,
                 CONSIGNEE,
                 SEAL_NO3,
                 CHOLD_CHK,
                 NVL (THOLD_CHK, 'N') AS THOLD_CHK,
                 IN_LANE,
                 OUT_LANE,
                 SOC_CHK,
                 NVL (DG_CHK, 'N') AS DG_CHK,
                 RETURN_RSN,
                 NVL (DOMESTIC_CHK, 'N') AS DOMESTIC_CHK,
                 LBAY,
                 LROW,
                 LTIER,
                 DBAY,
                 DROW,
                 DTIER,
                 BLOCK,
                 BAY,
                 ROWW,
                 TIER,
                 OWNER,
                 GWAY,
                 HANDLE_INSTR,
                 YHANDLE_INSTR,
                 YSPECIAL_TYPE,
                 ABS_CONST,
                 TRN_VOY,
                 TRN_VOY2,
                 TRUCKER2,
                 TRUCK_NO,
                 TRUCK_NO2,
                 UNPLUG_INSTR,
                 CNTR_COND,
                 DEFECTIVE_CODE,
                 CLEAN_CODE,
                 POWER_CODE,
                 NVL (M.REHANDLE_CODE, 'U') AS REHANDLE_CODE,
                 REHANDLE_RSN,
                 REHANDLE_STAFF,
                 LCL_FCL,
                 DHD,
                 LHD,
                 DHATCH_IDX,
                 LHATCH_IDX,
                 NULL DMG_CHK,
                 STUFF_CHK,
                 NVL (M.OVERLAND_CHK, 'N') AS OVERLAND_CHK,
                 NVL (M.RELEASE_CHK, 'N') AS RELEASE_CHK,
                 NULL INSPECT_CHK,
                 FORWARDER,
                 COMMODITY,
                 DEQU_NO,
                 LEQU_NO,
                 PREINFO_CHK,
                 LBAY_SEQ,
                 BAY_IDX,
                 ROW_IDX,
                 M.CNTR_ID,
                 M.CNTR_UID,
                 TO_NUMBER (
                      TRUNC (NVL (M.OUT_DATE, SYSDATE))
                    - TRUNC (NVL (M.IN_TMNL_DATE, M.IN_DATE))
                    + 1)
                    AS STACK_DAYS,
                 CEIL (
                    NVL (M.OUT_DATE, SYSDATE) - NVL (M.IN_TMNL_DATE, M.IN_DATE))
                    AS STACK_DAYS_D24,
                 M.DBAY || M.DROW || M.DTIER AS SHIP_LOCD,
                 M.LBAY || M.LROW || M.LTIER AS SHIP_LOCL,
                 M.VGM,
                 M.VGM_CHK,
                 M.CUSTOM_APP_TYPE,
                 M.COMMODITY_DESC,
                 M.CONSIGNEE_NM,
                 M.CNTR_RMK1
            FROM TB_MASTER M, TB_OVERSIZE O
           WHERE M.CNTR_ID = O.CNTR_ID(+)) M,
         TB_BERTHPLAN B,
         (    SELECT CNTR_UID,
                     SUBSTR (MAX (SYS_CONNECT_BY_PATH (HOLD_CODE, ',')), 2)
                        THOLD_CODES
                FROM (SELECT CNTR_UID,
                                HOLD_CODE
                             || CASE HOLD_CHK
                                   WHEN 'Y' THEN '(H)'
                                   WHEN 'N' THEN '(R)'
                                END
                                HOLD_CODE,
                             ROW_NUMBER ()
                                OVER (PARTITION BY CNTR_UID ORDER BY HOLD_CODE)
                                R_NUM
                        FROM TB_HOLD_STATE
                       WHERE HOLD_TYPE = 'T')
          START WITH R_NUM = 1
          CONNECT BY PRIOR R_NUM = R_NUM - 1 AND PRIOR CNTR_UID = CNTR_UID
            GROUP BY CNTR_UID) H
   WHERE     M.VSL_CD = B.VSL_CD
         AND M.CALL_YEAR = B.CALL_YEAR
         AND M.CALL_SEQ = B.CALL_SEQ
         AND M.CNTR_UID = H.CNTR_UID(+)
         AND M.PTNR_CODE = 'SIT'
         ORDER BY M.CNTR_NO ASC
         OFFSET 0 ROWS FETCH NEXT 50 ROWS ONLY
        
    </select>

</mapper>